{
  "version": 3,
  "sources": ["../src/game/constants.ts", "../src/game/game.ts", "../src/game/beatmap.ts", "../src/browser/audio.ts", "../src/browser/input.ts", "../src/browser/renderer.ts", "../src/browser/main.ts"],
  "sourcesContent": ["// Timing \u2014 dynamic approach: starts slow, gets faster as song progresses\nexport const APPROACH_TIME_MAX = 2.5;   // seconds \u2014 approach time at start of song (easy)\nexport const APPROACH_TIME_MIN = 0.8;   // seconds \u2014 approach time at end of song (hard)\nexport const PERFECT_WINDOW = 0.1;      // +-100ms for perfect hit\nexport const GOOD_WINDOW = 0.25;        // +-250ms for good hit\n\n// Lane layout\nexport const LANE_COUNT = 4;            // 4 lanes (index, middle, ring, pinky)\nexport const LANE_HIT_Y = 0.82;         // hit zone y-position near bottom of screen\n// Lane center x-positions: evenly spaced across screen\nexport const LANE_CENTERS: readonly number[] = [0.2, 0.4, 0.6, 0.8] as const;\n\n// Finger press detection\nexport const FINGER_SPEED_THRESHOLD = 0.8; // min downward finger speed (units/s) to register press\n\n// Scoring\nexport const PERFECT_SCORE = 300;\nexport const GOOD_SCORE = 100;\nexport const COMBO_MILESTONE = 10;      // combo milestone every N hits\nexport const MAX_MULTIPLIER = 8;\n\n// Health\nexport const MAX_HEALTH = 100;\nexport const MISS_DAMAGE = 3;\nexport const PERFECT_HEAL = 1;\n\n// Power system\nexport const POWER_SLOW_TIME_COMBO = 10;   // combo threshold for slow_time power\nexport const POWER_SHIELD_COMBO = 20;      // combo threshold for shield power\nexport const POWER_SCORE_BOOST_COMBO = 30; // combo threshold for score_boost power\nexport const POWER_DURATION = 5.0;         // seconds each power lasts\nexport const SLOW_TIME_FACTOR = 0.4;       // game speed multiplier during slow_time\nexport const SCORE_BOOST_MULTIPLIER = 2;   // score multiplier during score_boost\n\n// Effects\nexport const HIT_EFFECT_DURATION = 0.6;\nexport const MISS_EFFECT_DURATION = 0.5;\nexport const DAMAGE_EFFECT_DURATION = 0.4;\nexport const COMBO_EFFECT_DURATION = 0.8;\n\n// Countdown\nexport const COUNTDOWN_SECONDS = 3;\n", "import type {\n  ActiveSlash,\n  AudioPlayer,\n  Beatmap,\n  Effect,\n  GamePhase,\n  GestureSample,\n  HitCounts,\n  PowerState,\n} from \"./types.ts\";\n\nimport {\n  APPROACH_TIME_MAX,\n  APPROACH_TIME_MIN,\n  COMBO_EFFECT_DURATION,\n  COMBO_MILESTONE,\n  COUNTDOWN_SECONDS,\n  GOOD_SCORE,\n  GOOD_WINDOW,\n  HIT_EFFECT_DURATION,\n  LANE_CENTERS,\n  LANE_HIT_Y,\n  MAX_HEALTH,\n  MAX_MULTIPLIER,\n  MISS_DAMAGE,\n  MISS_EFFECT_DURATION,\n  PERFECT_HEAL,\n  PERFECT_SCORE,\n  PERFECT_WINDOW,\n  POWER_DURATION,\n  POWER_SCORE_BOOST_COMBO,\n  POWER_SHIELD_COMBO,\n  POWER_SLOW_TIME_COMBO,\n  SCORE_BOOST_MULTIPLIER,\n} from \"./constants.ts\";\n\n/** Compute the screen x-position for a given lane index. */\nfunction laneCenterX(lane: number): number {\n  return LANE_CENTERS[lane] ?? 0.5;\n}\n\nexport class Game {\n  beatmap: Beatmap;\n  phase: GamePhase = \"menu\";\n  time = 0;\n  score = 0;\n  combo = 0;\n  maxCombo = 0;\n  health = MAX_HEALTH;\n  slashes: ActiveSlash[] = [];\n  effects: Effect[] = [];\n  nextEvent = 0;\n  hits: HitCounts = { perfect: 0, good: 0, miss: 0 };\n  countdownValue = COUNTDOWN_SECONDS;\n  power: PowerState = \"none\";\n  powerTimeLeft = 0;\n\n  private _countdownStart = 0;\n  private _playStart = 0;\n  private _lastComboMilestone = 0;\n\n  constructor(beatmap: Beatmap) {\n    this.beatmap = beatmap;\n  }\n\n  start(now: number): void {\n    this.phase = \"countdown\";\n    this.time = 0;\n    this.score = 0;\n    this.combo = 0;\n    this.maxCombo = 0;\n    this.health = MAX_HEALTH;\n    this.slashes = [];\n    this.effects = [];\n    this.nextEvent = 0;\n    this.hits = { perfect: 0, good: 0, miss: 0 };\n    this.countdownValue = COUNTDOWN_SECONDS;\n    this._countdownStart = now;\n    this._playStart = 0;\n    this._lastComboMilestone = 0;\n    this.power = \"none\";\n    this.powerTimeLeft = 0;\n  }\n\n  update(now: number, dt: number, gesture: GestureSample, audio: AudioPlayer): void {\n    if (this.phase === \"countdown\") {\n      this._updateCountdown(now);\n      return;\n    }\n\n    if (this.phase !== \"playing\") return;\n\n    // Apply slow-time power\n    const effectiveDt = this.power === \"slow_time\"\n      ? dt * (1 - (1 - 0.4) * Math.min(this.powerTimeLeft / POWER_DURATION, 1))\n      : dt;\n\n    this.time = now - this._playStart;\n\n    this._spawnEvents(audio);\n    this._updateSlashes(gesture, audio);\n    this._updatePower(effectiveDt);\n    this._updateEffects(effectiveDt);\n\n    this.health = Math.max(0, Math.min(MAX_HEALTH, this.health));\n\n    if (this.health <= 0) {\n      this.phase = \"gameover\";\n      return;\n    }\n\n    if (this.time >= this.beatmap.duration) {\n      this.phase = \"results\";\n    }\n  }\n\n  /** Advance game time directly (for testing without real clock) */\n  tick(dt: number, gesture: GestureSample, audio: AudioPlayer): void {\n    if (this.phase === \"countdown\") {\n      this.countdownValue -= dt;\n      if (this.countdownValue <= 0) {\n        this.phase = \"playing\";\n        this.time = 0;\n      }\n      return;\n    }\n\n    if (this.phase !== \"playing\") return;\n\n    // Apply slow-time power to dt\n    const effectiveDt = this.power === \"slow_time\"\n      ? dt * 0.4\n      : dt;\n\n    this.time += dt;\n\n    this._spawnEvents(audio);\n    this._updateSlashes(gesture, audio);\n    this._updatePower(effectiveDt);\n    this._updateEffects(effectiveDt);\n\n    this.health = Math.max(0, Math.min(MAX_HEALTH, this.health));\n\n    if (this.health <= 0) {\n      this.phase = \"gameover\";\n      return;\n    }\n\n    if (this.time >= this.beatmap.duration) {\n      this.phase = \"results\";\n    }\n  }\n\n  // ---- Private ----\n\n  private _updateCountdown(now: number): void {\n    const elapsed = now - this._countdownStart;\n    this.countdownValue = COUNTDOWN_SECONDS - elapsed;\n    if (elapsed >= COUNTDOWN_SECONDS) {\n      this.phase = \"playing\";\n      this._playStart = now;\n      this.time = 0;\n    }\n  }\n\n  private _spawnEvents(audio: AudioPlayer): void {\n    while (this.nextEvent < this.beatmap.events.length) {\n      const event = this.beatmap.events[this.nextEvent];\n\n      // Dynamic approach time: longer at start of song, shorter as it progresses\n      const progress = Math.min(event.time / this.beatmap.duration, 1);\n      const approachTime = APPROACH_TIME_MAX - (APPROACH_TIME_MAX - APPROACH_TIME_MIN) * progress;\n      const spawnTime = event.time - approachTime;\n\n      if (spawnTime <= this.time) {\n        // Safety net: legacy events may lack lane at runtime\n        const lane: number = typeof event.lane === \"number\" ? event.lane : 0;\n        this.slashes.push({\n          lane,\n          time: event.time,\n          approachTime,\n          hit: false,\n          missed: false,\n        });\n        audio.playTick();\n        this.nextEvent++;\n      } else {\n        break;\n      }\n    }\n  }\n\n  private _updateSlashes(gesture: GestureSample, audio: AudioPlayer): void {\n    for (let i = this.slashes.length - 1; i >= 0; i--) {\n      const slash = this.slashes[i];\n      const timeDiff = this.time - slash.time;\n\n      // Check hit: within timing window and lane is pressed\n      if (!slash.hit && !slash.missed && Math.abs(timeDiff) <= GOOD_WINDOW) {\n        if (gesture.lanesPressed[slash.lane]) {\n          slash.hit = true;\n          const isPerfect = Math.abs(timeDiff) <= PERFECT_WINDOW;\n          this._registerHit(isPerfect, slash, audio);\n        }\n      }\n\n      // Miss: timing window passed without a hit\n      if (!slash.hit && !slash.missed && timeDiff > GOOD_WINDOW) {\n        slash.missed = true;\n        this._registerMiss(slash, audio);\n      }\n\n      // Cleanup\n      if (timeDiff > GOOD_WINDOW + 0.8) {\n        this.slashes.splice(i, 1);\n      }\n    }\n  }\n\n  private _updatePower(dt: number): void {\n    if (this.power === \"none\") return;\n    this.powerTimeLeft -= dt;\n    if (this.powerTimeLeft <= 0) {\n      this.power = \"none\";\n      this.powerTimeLeft = 0;\n    }\n  }\n\n  private _updateEffects(dt: number): void {\n    for (let i = this.effects.length - 1; i >= 0; i--) {\n      this.effects[i].life -= dt;\n      if (this.effects[i].life <= 0) {\n        this.effects.splice(i, 1);\n      }\n    }\n  }\n\n  private _activatePower(power: PowerState): void {\n    this.power = power;\n    this.powerTimeLeft = POWER_DURATION;\n  }\n\n  private _registerHit(\n    isPerfect: boolean,\n    slash: ActiveSlash,\n    audio: AudioPlayer,\n  ): void {\n    this.combo++;\n    if (this.combo > this.maxCombo) this.maxCombo = this.combo;\n\n    const multiplier = Math.min(\n      Math.floor(this.combo / COMBO_MILESTONE) + 1,\n      MAX_MULTIPLIER,\n    );\n    const baseScore = isPerfect ? PERFECT_SCORE : GOOD_SCORE;\n    const boostMult = this.power === \"score_boost\" ? SCORE_BOOST_MULTIPLIER : 1;\n    this.score += baseScore * multiplier * boostMult;\n\n    const effectX = laneCenterX(slash.lane);\n    const effectY = LANE_HIT_Y;\n\n    if (isPerfect) {\n      this.hits.perfect++;\n      audio.playHit(1.0);\n      audio.playSlash(1.0);\n      this.health = Math.min(MAX_HEALTH, this.health + PERFECT_HEAL);\n    } else {\n      this.hits.good++;\n      audio.playHit(0.6);\n      audio.playSlash(0.6);\n    }\n\n    // Combo milestone effects and powers\n    const milestone =\n      Math.floor(this.combo / COMBO_MILESTONE) * COMBO_MILESTONE;\n    if (milestone > 0 && milestone > this._lastComboMilestone) {\n      this._lastComboMilestone = milestone;\n      audio.playCombo();\n      this.effects.push({\n        type: \"combo_milestone\",\n        x: 0.5,\n        y: 0.5,\n        life: COMBO_EFFECT_DURATION,\n        maxLife: COMBO_EFFECT_DURATION,\n        value: milestone,\n      });\n\n      // Activate power at milestone thresholds\n      if (milestone === POWER_SLOW_TIME_COMBO) {\n        this._activatePower(\"slow_time\");\n      } else if (milestone === POWER_SHIELD_COMBO) {\n        this._activatePower(\"shield\");\n      } else if (milestone === POWER_SCORE_BOOST_COMBO) {\n        this._activatePower(\"score_boost\");\n      }\n    }\n\n    this.effects.push({\n      type: isPerfect ? \"perfect\" : \"good\",\n      x: effectX,\n      y: effectY,\n      life: HIT_EFFECT_DURATION,\n      maxLife: HIT_EFFECT_DURATION,\n    });\n  }\n\n  private _registerMiss(slash: ActiveSlash, audio: AudioPlayer): void {\n    this.hits.miss++;\n    this.combo = 0;\n    this._lastComboMilestone = 0;\n    this.health -= MISS_DAMAGE;\n    audio.playMiss();\n    this.effects.push({\n      type: \"miss\",\n      x: laneCenterX(slash.lane),\n      y: LANE_HIT_Y,\n      life: MISS_EFFECT_DURATION,\n      maxLife: MISS_EFFECT_DURATION,\n    });\n  }\n}\n", "import type { Beatmap, SlashEvent } from \"./types.ts\";\nimport { LANE_COUNT } from \"./constants.ts\";\n\n/** Map an old x position (0..1) to the nearest lane index (0..LANE_COUNT-1). */\nfunction xToLane(x: number): number {\n  // Lane centers at (i+1)/(LANE_COUNT+1) for i in 0..3 \u2192 0.2, 0.4, 0.6, 0.8\n  let best = 0;\n  let bestDist = Infinity;\n  for (let i = 0; i < LANE_COUNT; i++) {\n    const center = (i + 1) / (LANE_COUNT + 1);\n    const dist = Math.abs(x - center);\n    if (dist < bestDist) {\n      bestDist = dist;\n      best = i;\n    }\n  }\n  return best;\n}\n\n/** Raw beatmap event from JSON \u2014 may be legacy format without lane. */\ninterface RawEvent {\n  time: number;\n  type: string;\n  lane?: number;\n  x?: number;\n  y?: number;\n  direction?: string;\n}\n\n/** Raw beatmap from JSON \u2014 events may be legacy format. */\ninterface RawBeatmap {\n  bpm: number;\n  duration: number;\n  events: RawEvent[];\n  energyTimeline?: { time: number; energy: number }[];\n}\n\n/** Convert a beatmap loaded from JSON, handling legacy formats without lane. */\nexport function convertLegacyBeatmap(raw: RawBeatmap): Beatmap {\n  const events: SlashEvent[] = raw.events.map((e, i) => {\n    // New format: already has a lane field\n    if (typeof e.lane === \"number\" && e.lane >= 0 && e.lane < LANE_COUNT) {\n      return {\n        time: e.time,\n        type: \"slash\" as const,\n        lane: e.lane,\n      };\n    }\n\n    // Legacy format with x position: map to nearest lane\n    if (typeof e.x === \"number\") {\n      return {\n        time: e.time,\n        type: \"slash\" as const,\n        lane: xToLane(e.x),\n      };\n    }\n\n    // Fallback: cycle through lanes\n    return {\n      time: e.time,\n      type: \"slash\" as const,\n      lane: i % LANE_COUNT,\n    };\n  });\n\n  return {\n    bpm: raw.bpm,\n    duration: raw.duration,\n    events,\n    energyTimeline: raw.energyTimeline,\n  };\n}\n\nexport function generateBeatmap(bpm = 140, duration = 60): Beatmap {\n  const events: SlashEvent[] = [];\n  const beatInterval = 60 / bpm;\n\n  let time = 3;\n  let lastLane = -1;\n\n  while (time < duration - 5) {\n    const progress = time / duration;\n\n    // Interval decreases with progression\n    const interval =\n      progress < 0.2 ? beatInterval * 2 :\n      progress < 0.5 ? beatInterval :\n      progress < 0.8 ? beatInterval * 0.75 :\n      beatInterval * 0.5;\n\n    // Choose lane: avoid repeating the same lane\n    let lane: number;\n    if (progress < 0.25) {\n      // Early: inner lanes only (1, 2) for easier play\n      const innerLanes = [1, 2];\n      const filtered = innerLanes.filter((l) => l !== lastLane);\n      lane = filtered.length > 0\n        ? filtered[Math.floor(Math.random() * filtered.length)]\n        : innerLanes[Math.floor(Math.random() * innerLanes.length)];\n    } else {\n      // All lanes, avoid repeat\n      const allLanes = Array.from({ length: LANE_COUNT }, (_, i) => i);\n      const filtered = allLanes.filter((l) => l !== lastLane);\n      lane = filtered[Math.floor(Math.random() * filtered.length)];\n    }\n\n    events.push({ time, type: \"slash\", lane });\n    lastLane = lane;\n\n    time += interval;\n  }\n\n  events.sort((a, b) => a.time - b.time);\n  return { bpm, duration, events };\n}\n", "import type { AudioPlayer } from \"../game/types.ts\";\n\nexport class AudioManager implements AudioPlayer {\n  private ctx: AudioContext | null = null;\n  private musicSource: AudioBufferSourceNode | null = null;\n  private musicGain: GainNode | null = null;\n  private musicStartTime = 0;\n  private musicBuffer: AudioBuffer | null = null;\n  private musicRawData: ArrayBuffer | null = null;\n  private _musicMuted = false;\n  private _musicVolume = 0.5;\n\n  async init(): Promise<void> {\n    this.ctx = new (\n      (window as unknown as Record<string, typeof AudioContext>).AudioContext ||\n      (window as unknown as Record<string, typeof AudioContext>).webkitAudioContext\n    )();\n    await this.ctx.resume();\n\n    // If raw MP3 data was fetched before init, decode it now\n    if (this.musicRawData && !this.musicBuffer) {\n      this.musicBuffer = await this.ctx.decodeAudioData(this.musicRawData);\n      this.musicRawData = null;\n    }\n  }\n\n  /** Fetch an MP3 file for later playback. Can be called before init(). */\n  async loadMusic(url: string): Promise<void> {\n    const resp = await fetch(url);\n    const arrayBuf = await resp.arrayBuffer();\n\n    if (this.ctx) {\n      // AudioContext ready \u2014 decode immediately\n      this.musicBuffer = await this.ctx.decodeAudioData(arrayBuf);\n    } else {\n      // Store raw bytes; will be decoded when init() is called\n      this.musicRawData = arrayBuf;\n    }\n  }\n\n  /** Start playing loaded music. Returns the AudioContext time at which it started. */\n  startMusic(): number {\n    if (!this.ctx || !this.musicBuffer) return 0;\n    this.stopMusic();\n\n    this.musicGain = this.ctx.createGain();\n    this.musicGain.gain.value = 0.5;\n    this.musicGain.connect(this.ctx.destination);\n\n    this.musicSource = this.ctx.createBufferSource();\n    this.musicSource.buffer = this.musicBuffer;\n    this.musicSource.connect(this.musicGain);\n    this.musicSource.start();\n    this.musicStartTime = this.ctx.currentTime;\n    return this.musicStartTime;\n  }\n\n  /** Get current music playback time in seconds. */\n  getMusicTime(): number {\n    if (!this.ctx || !this.musicStartTime) return 0;\n    return this.ctx.currentTime - this.musicStartTime;\n  }\n\n  /** Stop music playback. */\n  stopMusic(): void {\n    if (this.musicSource) {\n      try { this.musicSource.stop(); } catch { /* already stopped */ }\n      this.musicSource = null;\n    }\n    this.musicStartTime = 0;\n  }\n\n  /** Toggle music mute state. Returns the new muted state. */\n  toggleMusicMute(): boolean {\n    this._musicMuted = !this._musicMuted;\n    if (this.musicGain) {\n      this.musicGain.gain.value = this._musicMuted ? 0 : this._musicVolume;\n    }\n    return this._musicMuted;\n  }\n\n  /** Whether music is currently muted. */\n  get musicMuted(): boolean {\n    return this._musicMuted;\n  }\n\n  private _play(setup: (t: number, ctx: AudioContext) => void): void {\n    if (!this.ctx) return;\n    try {\n      setup(this.ctx.currentTime, this.ctx);\n    } catch {\n      // Silently ignore audio errors (e.g. too many nodes)\n    }\n  }\n\n  // --- Cyberpunk / deep sound effects ---\n\n  /** Sub-bass thump when target spawns (replaces chirpy 600Hz sine). */\n  playTick(): void {\n    this._play((t, ctx) => {\n      // Sub-bass thump: 150 \u2192 60 Hz\n      const osc = ctx.createOscillator();\n      const gain = ctx.createGain();\n      osc.type = \"sine\";\n      osc.frequency.setValueAtTime(150, t);\n      osc.frequency.exponentialRampToValueAtTime(60, t + 0.08);\n      gain.gain.setValueAtTime(0.15, t);\n      gain.gain.exponentialRampToValueAtTime(0.001, t + 0.08);\n      osc.connect(gain).connect(ctx.destination);\n      osc.start(t);\n      osc.stop(t + 0.09);\n\n      // Short noise burst for attack transient\n      const bufSize = ctx.sampleRate * 0.02;\n      const noiseBuf = ctx.createBuffer(1, bufSize, ctx.sampleRate);\n      const data = noiseBuf.getChannelData(0);\n      for (let i = 0; i < bufSize; i++) data[i] = (Math.random() * 2 - 1) * 0.3;\n      const noise = ctx.createBufferSource();\n      noise.buffer = noiseBuf;\n      const noiseGain = ctx.createGain();\n      noiseGain.gain.setValueAtTime(0.06, t);\n      noiseGain.gain.exponentialRampToValueAtTime(0.001, t + 0.02);\n      // Low-pass to keep it dark\n      const lp = ctx.createBiquadFilter();\n      lp.type = \"lowpass\";\n      lp.frequency.value = 400;\n      noise.connect(lp).connect(noiseGain).connect(ctx.destination);\n      noise.start(t);\n      noise.stop(t + 0.03);\n    });\n  }\n\n  /** Deep impact on hit (replaces 660-880Hz). Sub-bass layer + mid punch. */\n  playHit(intensity: number): void {\n    this._play((t, ctx) => {\n      const intens = Math.max(0.1, intensity);\n\n      // Main impact: 180-280 Hz \u2192 90 Hz\n      const freq = 180 + 100 * intens;\n      const osc = ctx.createOscillator();\n      const gain = ctx.createGain();\n      osc.type = \"triangle\";\n      osc.frequency.setValueAtTime(freq, t);\n      osc.frequency.exponentialRampToValueAtTime(90, t + 0.15);\n      gain.gain.setValueAtTime(0.22, t);\n      gain.gain.exponentialRampToValueAtTime(0.001, t + 0.15);\n      osc.connect(gain).connect(ctx.destination);\n      osc.start(t);\n      osc.stop(t + 0.16);\n\n      // Sub-bass layer: 55 Hz constant\n      const sub = ctx.createOscillator();\n      const subGain = ctx.createGain();\n      sub.type = \"sine\";\n      sub.frequency.setValueAtTime(55, t);\n      subGain.gain.setValueAtTime(0.18 * intens, t);\n      subGain.gain.exponentialRampToValueAtTime(0.001, t + 0.12);\n      sub.connect(subGain).connect(ctx.destination);\n      sub.start(t);\n      sub.stop(t + 0.13);\n\n      // Click transient (very short noise burst for punch)\n      const clickOsc = ctx.createOscillator();\n      const clickGain = ctx.createGain();\n      clickOsc.type = \"square\";\n      clickOsc.frequency.setValueAtTime(freq * 1.5, t);\n      clickOsc.frequency.exponentialRampToValueAtTime(80, t + 0.03);\n      clickGain.gain.setValueAtTime(0.06, t);\n      clickGain.gain.exponentialRampToValueAtTime(0.001, t + 0.03);\n      clickOsc.connect(clickGain).connect(ctx.destination);\n      clickOsc.start(t);\n      clickOsc.stop(t + 0.04);\n    });\n  }\n\n  /** Extended low buzz with distortion layer (replaces short 120\u219240Hz square). */\n  playMiss(): void {\n    this._play((t, ctx) => {\n      // Main descending buzz: 100 \u2192 30 Hz\n      const osc = ctx.createOscillator();\n      const gain = ctx.createGain();\n      osc.type = \"square\";\n      osc.frequency.setValueAtTime(100, t);\n      osc.frequency.exponentialRampToValueAtTime(30, t + 0.3);\n      gain.gain.setValueAtTime(0.1, t);\n      gain.gain.exponentialRampToValueAtTime(0.001, t + 0.3);\n      osc.connect(gain).connect(ctx.destination);\n      osc.start(t);\n      osc.stop(t + 0.31);\n\n      // Distortion layer: detuned sawtooth\n      const dist = ctx.createOscillator();\n      const distGain = ctx.createGain();\n      dist.type = \"sawtooth\";\n      dist.frequency.setValueAtTime(67, t);\n      dist.frequency.exponentialRampToValueAtTime(22, t + 0.25);\n      distGain.gain.setValueAtTime(0.05, t);\n      distGain.gain.exponentialRampToValueAtTime(0.001, t + 0.25);\n      dist.connect(distGain).connect(ctx.destination);\n      dist.start(t);\n      dist.stop(t + 0.26);\n    });\n  }\n\n  /** Metallic crunch + deep rumble (replaces random 80-240Hz sawtooths). */\n  playDamage(): void {\n    this._play((t, ctx) => {\n      // Sub rumble: 40 Hz\n      const sub = ctx.createOscillator();\n      const subGain = ctx.createGain();\n      sub.type = \"sine\";\n      sub.frequency.setValueAtTime(40, t);\n      subGain.gain.setValueAtTime(0.2, t);\n      subGain.gain.exponentialRampToValueAtTime(0.001, t + 0.2);\n      sub.connect(subGain).connect(ctx.destination);\n      sub.start(t);\n      sub.stop(t + 0.21);\n\n      // Metallic crunch: multiple detuned sawtooths 60-120 Hz\n      for (let i = 0; i < 4; i++) {\n        const osc = ctx.createOscillator();\n        const gain = ctx.createGain();\n        osc.type = \"sawtooth\";\n        const baseFreq = 60 + Math.random() * 60;\n        osc.frequency.setValueAtTime(baseFreq, t);\n        osc.frequency.exponentialRampToValueAtTime(baseFreq * 0.4, t + 0.15);\n        gain.gain.setValueAtTime(0.06, t);\n        gain.gain.exponentialRampToValueAtTime(0.001, t + 0.15);\n        osc.connect(gain).connect(ctx.destination);\n        osc.start(t);\n        osc.stop(t + 0.16);\n      }\n\n      // Noise burst for metallic impact texture\n      const bufSize = ctx.sampleRate * 0.05;\n      const noiseBuf = ctx.createBuffer(1, bufSize, ctx.sampleRate);\n      const data = noiseBuf.getChannelData(0);\n      for (let i = 0; i < bufSize; i++) data[i] = (Math.random() * 2 - 1);\n      const noise = ctx.createBufferSource();\n      noise.buffer = noiseBuf;\n      const noiseGain = ctx.createGain();\n      noiseGain.gain.setValueAtTime(0.08, t);\n      noiseGain.gain.exponentialRampToValueAtTime(0.001, t + 0.05);\n      const bp = ctx.createBiquadFilter();\n      bp.type = \"bandpass\";\n      bp.frequency.value = 200;\n      bp.Q.value = 2;\n      noise.connect(bp).connect(noiseGain).connect(ctx.destination);\n      noise.start(t);\n      noise.stop(t + 0.06);\n    });\n  }\n\n  /** Sharp whoosh for slash gesture: noise burst + high-frequency sweep. */\n  playSlash(intensity: number): void {\n    this._play((t, ctx) => {\n      const intens = Math.max(0.1, intensity);\n\n      // Noise burst for whoosh texture\n      const bufSize = ctx.sampleRate * 0.08;\n      const noiseBuf = ctx.createBuffer(1, bufSize, ctx.sampleRate);\n      const data = noiseBuf.getChannelData(0);\n      for (let i = 0; i < bufSize; i++) data[i] = (Math.random() * 2 - 1);\n      const noise = ctx.createBufferSource();\n      noise.buffer = noiseBuf;\n\n      // High-pass to get the \"swoosh\" character\n      const hp = ctx.createBiquadFilter();\n      hp.type = \"highpass\";\n      hp.frequency.setValueAtTime(2000, t);\n      hp.frequency.exponentialRampToValueAtTime(6000, t + 0.05);\n\n      const noiseGain = ctx.createGain();\n      noiseGain.gain.setValueAtTime(0.18 * intens, t);\n      noiseGain.gain.exponentialRampToValueAtTime(0.001, t + 0.08);\n      noise.connect(hp).connect(noiseGain).connect(ctx.destination);\n      noise.start(t);\n      noise.stop(t + 0.09);\n\n      // High-frequency sweep tone\n      const osc = ctx.createOscillator();\n      const oscGain = ctx.createGain();\n      osc.type = \"sine\";\n      osc.frequency.setValueAtTime(3000 * intens, t);\n      osc.frequency.exponentialRampToValueAtTime(800, t + 0.06);\n      oscGain.gain.setValueAtTime(0.06 * intens, t);\n      oscGain.gain.exponentialRampToValueAtTime(0.001, t + 0.06);\n      osc.connect(oscGain).connect(ctx.destination);\n      osc.start(t);\n      osc.stop(t + 0.07);\n    });\n  }\n\n  /** Dark power chord C2-G2-C3 with sawtooth (replaces cheerful C5-E5-G5 arpeggio). */\n  playCombo(): void {\n    this._play((t, ctx) => {\n      const notes = [65.4, 98.0, 130.8]; // C2, G2, C3 \u2014 dark power chord\n      notes.forEach((freq, i) => {\n        const osc = ctx.createOscillator();\n        const gain = ctx.createGain();\n        osc.type = \"sawtooth\";\n        osc.frequency.setValueAtTime(freq, t + i * 0.04);\n        gain.gain.setValueAtTime(0.1, t + i * 0.04);\n        gain.gain.exponentialRampToValueAtTime(0.001, t + i * 0.04 + 0.25);\n        // Low-pass to keep it dark and rumbling\n        const lp = ctx.createBiquadFilter();\n        lp.type = \"lowpass\";\n        lp.frequency.value = 500;\n        osc.connect(lp).connect(gain).connect(ctx.destination);\n        osc.start(t + i * 0.04);\n        osc.stop(t + i * 0.04 + 0.26);\n      });\n\n      // Sub reinforcement\n      const sub = ctx.createOscillator();\n      const subGain = ctx.createGain();\n      sub.type = \"sine\";\n      sub.frequency.setValueAtTime(32.7, t); // C1\n      subGain.gain.setValueAtTime(0.12, t);\n      subGain.gain.exponentialRampToValueAtTime(0.001, t + 0.3);\n      sub.connect(subGain).connect(ctx.destination);\n      sub.start(t);\n      sub.stop(t + 0.31);\n    });\n  }\n}\n", "import type { Vec2 } from \"../game/types.ts\";\nimport type { GestureSample } from \"../game/types.ts\";\nimport { LANE_COUNT, FINGER_SPEED_THRESHOLD } from \"../game/constants.ts\";\n\n/** A single normalized hand landmark from MediaPipe. */\nexport interface HandLandmark {\n  x: number;\n  y: number;\n  z: number;\n}\n\n// MediaPipe type declarations (loaded via CDN, not imported)\ndeclare const Hands: unknown;\ndeclare const Camera: unknown;\n\nexport type InputMode = \"hand\" | \"mouse\" | \"touch\" | \"none\";\n\n/** Index of the landmark used for cursor control. */\nconst CURSOR_LANDMARK = 9; // MIDDLE_FINGER_MCP (palm center) \u2014 more stable than fingertip\n\n// Hand tracking input clamp range \u2014 normalized [0..1] camera coordinates.\nconst HAND_CLAMP_MIN = 0.25;\nconst HAND_CLAMP_MAX = 0.75;\n\n// Finger tip landmarks for lane detection (index, middle, ring, pinky)\nconst FINGER_TIP_LANDMARKS = [8, 12, 16, 20] as const;\n\n// Rolling average window size for finger velocity smoothing\nconst VELOCITY_WINDOW = 3;\n\n// Keyboard lane mapping: A=0, S=1, D=2, F=3\nconst KEY_LANE_MAP: Record<string, number> = {\n  \"a\": 0, \"A\": 0,\n  \"s\": 1, \"S\": 1,\n  \"d\": 2, \"D\": 2,\n  \"f\": 3, \"F\": 3,\n};\n\nexport class InputManager {\n  cursor: Vec2 = { x: 0.5, y: 0.5 };\n  mode: InputMode = \"none\";\n  detected = false;\n\n  /** Latest raw hand landmarks (21 points) from MediaPipe, or null. */\n  landmarks: HandLandmark[] | null = null;\n  /** Which landmark index drives the cursor. */\n  readonly cursorLandmarkIndex = CURSOR_LANDMARK;\n  /** Hand input clamp boundaries (normalized camera coords). */\n  readonly clampMin = HAND_CLAMP_MIN;\n  readonly clampMax = HAND_CLAMP_MAX;\n\n  /** Current gesture sample: which lanes are pressed this frame. */\n  gesture: GestureSample = { lanesPressed: [false, false, false, false] };\n\n  private _raw: Vec2 = { x: 0.5, y: 0.5 };\n  private _smoothingSpeed = 12;\n\n  // Per-finger velocity tracking for downward flick detection\n  private _fingerPrevY: number[] = [0.5, 0.5, 0.5, 0.5];\n  private _fingerPrevTime: number[] = [0, 0, 0, 0];\n  private _fingerVelSamples: number[][] = [[], [], [], []]; // vy samples per finger\n  private _fingerLanesPressed: boolean[] = [false, false, false, false];\n\n  // Keyboard lane presses (edge-triggered, cleared after each frame)\n  private _keyLanesPressed: boolean[] = [false, false, false, false];\n\n  constructor(\n    private canvas: HTMLCanvasElement,\n    private video: HTMLVideoElement,\n  ) {\n    canvas.addEventListener(\"mousemove\", (e: MouseEvent) => {\n      const nx = e.clientX / window.innerWidth;\n      const ny = e.clientY / window.innerHeight;\n      this._raw.x = nx;\n      this._raw.y = ny;\n      if (this.mode !== \"hand\") this.mode = \"mouse\";\n      this.detected = true;\n    });\n\n    canvas.addEventListener(\n      \"touchstart\",\n      (e: TouchEvent) => {\n        e.preventDefault();\n        const t = e.touches[0];\n        const nx = t.clientX / window.innerWidth;\n        const ny = t.clientY / window.innerHeight;\n        this._raw.x = nx;\n        this._raw.y = ny;\n        if (this.mode !== \"hand\") this.mode = \"touch\";\n        this.detected = true;\n      },\n      { passive: false },\n    );\n\n    canvas.addEventListener(\n      \"touchmove\",\n      (e: TouchEvent) => {\n        e.preventDefault();\n        const t = e.touches[0];\n        const nx = t.clientX / window.innerWidth;\n        const ny = t.clientY / window.innerHeight;\n        this._raw.x = nx;\n        this._raw.y = ny;\n        if (this.mode !== \"hand\") this.mode = \"touch\";\n        this.detected = true;\n      },\n      { passive: false },\n    );\n\n    // Keyboard lane input\n    window.addEventListener(\"keydown\", (e: KeyboardEvent) => {\n      const lane = KEY_LANE_MAP[e.key];\n      if (lane !== undefined) {\n        this._keyLanesPressed[lane] = true;\n      }\n    });\n  }\n\n  async init(): Promise<InputMode> {\n    try {\n      await this._initHandTracking();\n      return \"hand\";\n    } catch (e) {\n      console.warn(\n        \"Hand tracking unavailable, using mouse/touch:\",\n        (e as Error).message,\n      );\n      return this.mode === \"none\" ? \"mouse\" : this.mode;\n    }\n  }\n\n  update(dt: number): void {\n    const factor = 1 - Math.exp(-this._smoothingSpeed * dt);\n    this.cursor.x += (this._raw.x - this.cursor.x) * factor;\n    this.cursor.y += (this._raw.y - this.cursor.y) * factor;\n\n    // Merge keyboard + hand tracking lane presses\n    const merged: boolean[] = [false, false, false, false];\n    for (let i = 0; i < LANE_COUNT; i++) {\n      merged[i] = this._keyLanesPressed[i] || this._fingerLanesPressed[i];\n    }\n    this.gesture = { lanesPressed: merged };\n\n    // Clear edge-triggered keyboard presses after consumption\n    this._keyLanesPressed = [false, false, false, false];\n  }\n\n  private _pushFingerVelocity(finger: number, vy: number): void {\n    const samples = this._fingerVelSamples[finger];\n    samples.push(vy);\n    if (samples.length > VELOCITY_WINDOW) {\n      samples.shift();\n    }\n\n    // Compute rolling average\n    let avg = 0;\n    for (let i = 0; i < samples.length; i++) {\n      avg += samples[i];\n    }\n    avg /= samples.length;\n\n    // Positive vy in camera space = downward movement (y increases downward)\n    this._fingerLanesPressed[finger] = avg > FINGER_SPEED_THRESHOLD;\n  }\n\n  private async _initHandTracking(): Promise<void> {\n    // deno-lint-ignore no-explicit-any\n    const W = window as any;\n    if (!W.Hands || !W.Camera) {\n      throw new Error(\"MediaPipe not loaded\");\n    }\n\n    const hands = new W.Hands({\n      locateFile: (file: string) =>\n        `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`,\n    });\n\n    hands.setOptions({\n      maxNumHands: 1,\n      modelComplexity: 0,\n      minDetectionConfidence: 0.6,\n      minTrackingConfidence: 0.5,\n    });\n\n    // deno-lint-ignore no-explicit-any\n    hands.onResults((results: any) => {\n      if (\n        results.multiHandLandmarks &&\n        results.multiHandLandmarks.length > 0\n      ) {\n        const hand = results.multiHandLandmarks[0];\n        this.landmarks = hand as HandLandmark[];\n        const point = hand[CURSOR_LANDMARK]; // palm center (MIDDLE_FINGER_MCP)\n\n        // Guard: MediaPipe may return incomplete landmarks\n        if (!point) return;\n\n        // Update cursor position from palm center\n        this._raw.x = this._mapRange(1 - point.x, HAND_CLAMP_MIN, HAND_CLAMP_MAX, 0, 1);\n        this._raw.y = this._mapRange(point.y, HAND_CLAMP_MIN, HAND_CLAMP_MAX, 0, 1);\n        this.mode = \"hand\";\n        this.detected = true;\n\n        // Track per-finger tip velocities for lane press detection\n        const now = performance.now() / 1000;\n        for (let f = 0; f < FINGER_TIP_LANDMARKS.length; f++) {\n          const tip = hand[FINGER_TIP_LANDMARKS[f]];\n          if (!tip) continue;\n\n          const elapsed = now - this._fingerPrevTime[f];\n          if (this._fingerPrevTime[f] > 0 && elapsed > 0 && elapsed < 0.2) {\n            const vy = (tip.y - this._fingerPrevY[f]) / elapsed;\n            this._pushFingerVelocity(f, vy);\n          }\n          this._fingerPrevY[f] = tip.y;\n          this._fingerPrevTime[f] = now;\n        }\n      } else {\n        this.landmarks = null;\n        // Reset finger presses when hand lost\n        this._fingerLanesPressed = [false, false, false, false];\n        this._fingerVelSamples = [[], [], [], []];\n      }\n    });\n\n    const camera = new W.Camera(this.video, {\n      onFrame: async () => {\n        await hands.send({ image: this.video });\n      },\n      width: 640,\n      height: 480,\n    });\n\n    await camera.start();\n    this.mode = \"hand\";\n  }\n\n  private _mapRange(\n    value: number,\n    inMin: number,\n    inMax: number,\n    outMin: number,\n    outMax: number,\n  ): number {\n    const mapped =\n      outMin + ((value - inMin) / (inMax - inMin)) * (outMax - outMin);\n    return Math.max(outMin, Math.min(outMax, mapped));\n  }\n}\n", "import type { Game } from \"../game/game.ts\";\nimport type { GestureSample, Vec2 } from \"../game/types.ts\";\nimport type { HandLandmark } from \"./input.ts\";\nimport {\n  GOOD_WINDOW,\n  LANE_CENTERS,\n  LANE_COUNT,\n  LANE_HIT_Y,\n} from \"../game/constants.ts\";\n\n// =========================================================================\n// Constants\n// =========================================================================\n\nconst FAR_Z = 5;\nconst RING_COUNT = 28;       // more rings for a denser tunnel\nconst STREAK_COUNT = 80;     // more speed streaks\nconst TUNNEL_RADIUS = 0.85;  // wider tunnel fills more of the screen\nconst SIDES = 4;             // rectangular cross-section\nconst MAX_LINES = 5000;      // increased for denser mesh\nconst MAX_CIRCLES = 600;     // max circle quads per frame\nconst RING_SEGMENTS = 24;    // polygon approximation for circle outlines\nconst PARALLAX_STRENGTH = 0.25; // how much cursor shifts the vanishing point\n\n// Lane colors: cyan, magenta, green, orange \u2014 one per lane\nconst LANE_COLORS: [number, number, number][] = [\n  [0, 1, 1],        // lane 0: cyan\n  [1, 0, 1],        // lane 1: magenta\n  [0, 1, 0.2],      // lane 2: green\n  [1, 0.6, 0],      // lane 3: orange\n];\n\n// =========================================================================\n// Color helpers\n// =========================================================================\n\nfunction hsl(h: number, s: number, l: number): [number, number, number] {\n  h = ((h % 360) + 360) % 360;\n  const c = (1 - Math.abs(2 * l - 1)) * s;\n  const hp = h / 60;\n  const x = c * (1 - Math.abs(hp % 2 - 1));\n  const m = l - c / 2;\n  let r = 0, g = 0, b = 0;\n  if (hp < 1) { r = c; g = x; }\n  else if (hp < 2) { r = x; g = c; }\n  else if (hp < 3) { g = c; b = x; }\n  else if (hp < 4) { g = x; b = c; }\n  else if (hp < 5) { r = x; b = c; }\n  else { r = c; b = x; }\n  return [r + m, g + m, b + m];\n}\n\n// Pre-computed named colors (RGB 0-1)\nconst COL = {\n  cursor:     [0, 1, 1] as [number, number, number],        // #0ff cyan\n  perfect:    [1, 1, 0] as [number, number, number],        // #ff0\n  good:       [0, 1, 0] as [number, number, number],        // #0f0\n  miss:       [1, 0.267, 0.267] as [number, number, number],// #f44\n  white:      [1, 1, 1] as [number, number, number],\n};\n\n// MediaPipe hand skeleton connections (pairs of landmark indices)\nconst HAND_CONNECTIONS: [number, number][] = [\n  [0, 1], [1, 2], [2, 3], [3, 4],       // thumb\n  [0, 5], [5, 6], [6, 7], [7, 8],       // index finger\n  [5, 9], [9, 10], [10, 11], [11, 12],  // middle finger\n  [9, 13], [13, 14], [14, 15], [15, 16],// ring finger\n  [13, 17], [17, 18], [18, 19], [19, 20],// pinky\n  [0, 17],                                // wrist to pinky base\n];\n\n// =========================================================================\n// Shader sources (GLSL 300 es)\n// =========================================================================\n\n// --- Flat shader: lines and triangles with per-vertex color ---\nconst FLAT_VS = `#version 300 es\nin vec2 a_pos;\nin vec4 a_color;\nuniform vec2 u_res;\nuniform vec2 u_shake;\nout vec4 v_color;\nvoid main() {\n  vec2 p = (a_pos + u_shake) / u_res * 2.0 - 1.0;\n  p.y = -p.y;\n  gl_Position = vec4(p, 0.0, 1.0);\n  v_color = a_color;\n}`;\n\nconst FLAT_FS = `#version 300 es\nprecision mediump float;\nin vec4 v_color;\nout vec4 fragColor;\nvoid main() {\n  fragColor = v_color;\n}`;\n\n// --- Circle shader: quads with SDF circle in fragment ---\nconst CIRCLE_VS = `#version 300 es\nin vec2 a_center;\nin vec2 a_offset;\nin float a_radius;\nin vec4 a_color;\nuniform vec2 u_res;\nuniform vec2 u_shake;\nout vec2 v_uv;\nout vec4 v_color;\nvoid main() {\n  vec2 pos = a_center + a_offset * a_radius + u_shake;\n  vec2 ndc = pos / u_res * 2.0 - 1.0;\n  ndc.y = -ndc.y;\n  gl_Position = vec4(ndc, 0.0, 1.0);\n  v_uv = a_offset;\n  v_color = a_color;\n}`;\n\nconst CIRCLE_FS = `#version 300 es\nprecision mediump float;\nin vec2 v_uv;\nin vec4 v_color;\nout vec4 fragColor;\nvoid main() {\n  float dist = length(v_uv);\n  float alpha = 1.0 - smoothstep(0.85, 1.0, dist);\n  fragColor = vec4(v_color.rgb, v_color.a * alpha);\n}`;\n\n// --- Screen quad vertex shader (shared by all post-processing) ---\nconst SCREEN_VS = `#version 300 es\nin vec2 a_pos;\nout vec2 v_uv;\nvoid main() {\n  gl_Position = vec4(a_pos, 0.0, 1.0);\n  v_uv = a_pos * 0.5 + 0.5;\n}`;\n\n// --- Background gradient ---\nconst BG_FS = `#version 300 es\nprecision mediump float;\nin vec2 v_uv;\nuniform vec3 u_cCenter;\nuniform vec3 u_cEdge;\nuniform float u_aspect;\nout vec4 fragColor;\nvoid main() {\n  vec2 p = (v_uv - 0.5) * vec2(u_aspect, 1.0);\n  float d = length(p) * 1.25;\n  vec3 c = mix(u_cCenter, u_cEdge, clamp(d, 0.0, 1.0));\n  fragColor = vec4(c, 1.0);\n}`;\n\n// --- Vanishing point glow (additive radial) ---\nconst GLOW_FS = `#version 300 es\nprecision mediump float;\nin vec2 v_uv;\nuniform vec3 u_color;\nuniform float u_alpha;\nuniform float u_radius;\nuniform float u_aspect;\nout vec4 fragColor;\nvoid main() {\n  vec2 p = (v_uv - 0.5) * vec2(u_aspect, 1.0);\n  float d = length(p) / u_radius;\n  float a = max(0.0, 1.0 - d) * u_alpha;\n  fragColor = vec4(u_color * a, a);\n}`;\n\n// --- Bloom bright extraction ---\nconst EXTRACT_FS = `#version 300 es\nprecision mediump float;\nin vec2 v_uv;\nuniform sampler2D u_tex;\nuniform float u_threshold;\nout vec4 fragColor;\nvoid main() {\n  vec4 c = texture(u_tex, v_uv);\n  float br = dot(c.rgb, vec3(0.2126, 0.7152, 0.0722));\n  float contrib = max(br - u_threshold, 0.0);\n  fragColor = vec4(c.rgb * (contrib / max(br, 0.001)), 1.0);\n}`;\n\n// --- Gaussian blur (separable, 9-tap) ---\nconst BLUR_FS = `#version 300 es\nprecision mediump float;\nin vec2 v_uv;\nuniform sampler2D u_tex;\nuniform vec2 u_dir;\nout vec4 fragColor;\nvoid main() {\n  float w[5] = float[](0.227027, 0.194596, 0.121621, 0.054054, 0.016216);\n  vec4 sum = texture(u_tex, v_uv) * w[0];\n  for (int i = 1; i < 5; i++) {\n    vec2 off = u_dir * float(i) * 1.5;\n    sum += texture(u_tex, v_uv + off) * w[i];\n    sum += texture(u_tex, v_uv - off) * w[i];\n  }\n  fragColor = sum;\n}`;\n\n// --- Final composite with scanlines + vignette ---\nconst FINAL_FS = `#version 300 es\nprecision highp float;\nin vec2 v_uv;\nuniform sampler2D u_scene;\nuniform sampler2D u_bloom;\nuniform float u_bloomStr;\nuniform float u_scanStr;\nuniform float u_vigStr;\nout vec4 fragColor;\nvoid main() {\n  vec3 scene = texture(u_scene, v_uv).rgb;\n  vec3 bloom = texture(u_bloom, v_uv).rgb;\n  vec3 color = scene + bloom * u_bloomStr;\n  float scan = pow(sin(gl_FragCoord.y * 3.14159265 / 3.0), 2.0);\n  color *= 1.0 - u_scanStr * scan;\n  vec2 q = v_uv * 2.0 - 1.0;\n  float vig = 1.0 - dot(q, q) * u_vigStr;\n  color *= max(vig, 0.0);\n  fragColor = vec4(color, 1.0);\n}`;\n\n// =========================================================================\n// GL helpers\n// =========================================================================\n\nfunction compileShader(gl: WebGL2RenderingContext, type: number, src: string): WebGLShader {\n  const s = gl.createShader(type)!;\n  gl.shaderSource(s, src);\n  gl.compileShader(s);\n  if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) {\n    const info = gl.getShaderInfoLog(s);\n    gl.deleteShader(s);\n    throw new Error(\"Shader compile error: \" + info);\n  }\n  return s;\n}\n\nfunction linkProgram(gl: WebGL2RenderingContext, vsSrc: string, fsSrc: string): WebGLProgram {\n  const vs = compileShader(gl, gl.VERTEX_SHADER, vsSrc);\n  const fs = compileShader(gl, gl.FRAGMENT_SHADER, fsSrc);\n  const p = gl.createProgram()!;\n  gl.attachShader(p, vs);\n  gl.attachShader(p, fs);\n  gl.linkProgram(p);\n  if (!gl.getProgramParameter(p, gl.LINK_STATUS)) {\n    const info = gl.getProgramInfoLog(p);\n    gl.deleteProgram(p);\n    throw new Error(\"Program link error: \" + info);\n  }\n  gl.deleteShader(vs);\n  gl.deleteShader(fs);\n  return p;\n}\n\ninterface FBO {\n  fb: WebGLFramebuffer;\n  tex: WebGLTexture;\n  w: number;\n  h: number;\n}\n\nfunction createFBO(gl: WebGL2RenderingContext, w: number, h: number): FBO {\n  const tex = gl.createTexture()!;\n  gl.bindTexture(gl.TEXTURE_2D, tex);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA16F, w, h, 0, gl.RGBA, gl.HALF_FLOAT, null);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n\n  const fb = gl.createFramebuffer()!;\n  gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\n  gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, tex, 0);\n  gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  gl.bindTexture(gl.TEXTURE_2D, null);\n  return { fb, tex, w, h };\n}\n\nfunction resizeFBO(gl: WebGL2RenderingContext, fbo: FBO, w: number, h: number): void {\n  fbo.w = w;\n  fbo.h = h;\n  gl.bindTexture(gl.TEXTURE_2D, fbo.tex);\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA16F, w, h, 0, gl.RGBA, gl.HALF_FLOAT, null);\n  gl.bindTexture(gl.TEXTURE_2D, null);\n}\n\n// =========================================================================\n// Streak interface\n// =========================================================================\n\ninterface Streak {\n  angle: number;\n  radius: number;\n  z: number;\n  speed: number;\n  brightness: number;\n}\n\n// =========================================================================\n// Renderer\n// =========================================================================\n\nexport class Renderer {\n  private gl: WebGL2RenderingContext;\n  private hud: CanvasRenderingContext2D;\n  private w = 0;  // CSS pixels\n  private h = 0;\n  private dpr = 1;\n\n  // --- Shader programs ---\n  private flatProg: WebGLProgram;\n  private flatLocs: { aPos: number; aColor: number; uRes: WebGLUniformLocation; uShake: WebGLUniformLocation };\n\n  private circleProg: WebGLProgram;\n  private circleLocs: { aCenter: number; aOffset: number; aRadius: number; aColor: number; uRes: WebGLUniformLocation; uShake: WebGLUniformLocation };\n\n  private bgProg: WebGLProgram;\n  private glowProg: WebGLProgram;\n  private extractProg: WebGLProgram;\n  private blurProg: WebGLProgram;\n  private finalProg: WebGLProgram;\n\n  // --- Geometry buffers ---\n  private lineVAO: WebGLVertexArrayObject;\n  private lineVBO: WebGLBuffer;\n  private lineData: Float32Array;\n  private lineCount = 0;\n\n  private circleVAO: WebGLVertexArrayObject;\n  private circleVBO: WebGLBuffer;\n  private circleData: Float32Array;\n  private circleCount = 0;\n\n  private quadVAO: WebGLVertexArrayObject;\n\n  // --- Framebuffers ---\n  private sceneFBO: FBO;\n  private bloomFBO: [FBO, FBO];\n\n  // --- Tunnel state ---\n  private rings: number[] = [];\n  private streaks: Streak[] = [];\n  private tunnelSpeed = 0;\n  private lastRenderTime = 0;\n  private shakeX = 0;\n  private shakeY = 0;\n  private shakeDecay = 0;\n  private energyIdx = 0;\n  // Parallax camera offset \u2014 smoothly follows cursor for 3D effect\n  private camOffX = 0;\n  private camOffY = 0;\n\n  muteButtonRect = { x: 0, y: 0, w: 0, h: 0 };\n  camDebugButtonRect = { x: 0, y: 0, w: 0, h: 0 };\n  camDebugVisible = false;\n\n  private _camOverlay: CanvasRenderingContext2D | null = null;\n  private _camDebugEl: HTMLElement | null = null;\n  private _camPreviewVideo: HTMLVideoElement | null = null;\n\n  constructor(private glCanvas: HTMLCanvasElement, private hudCanvas: HTMLCanvasElement) {\n    // --- WebGL context ---\n    const gl = glCanvas.getContext(\"webgl2\", { alpha: false, antialias: false, premultipliedAlpha: false });\n    if (!gl) throw new Error(\"WebGL 2 not supported\");\n    this.gl = gl;\n\n    // Check for float texture support (required for HDR bloom)\n    const ext = gl.getExtension(\"EXT_color_buffer_half_float\");\n    if (!ext) {\n      // Fallback: try regular float\n      gl.getExtension(\"EXT_color_buffer_float\");\n    }\n\n    // --- HUD context ---\n    const hud = hudCanvas.getContext(\"2d\");\n    if (!hud) throw new Error(\"Cannot get 2d context for HUD\");\n    this.hud = hud;\n\n    // --- Compile programs ---\n    this.flatProg = linkProgram(gl, FLAT_VS, FLAT_FS);\n    this.flatLocs = {\n      aPos: gl.getAttribLocation(this.flatProg, \"a_pos\"),\n      aColor: gl.getAttribLocation(this.flatProg, \"a_color\"),\n      uRes: gl.getUniformLocation(this.flatProg, \"u_res\")!,\n      uShake: gl.getUniformLocation(this.flatProg, \"u_shake\")!,\n    };\n\n    this.circleProg = linkProgram(gl, CIRCLE_VS, CIRCLE_FS);\n    this.circleLocs = {\n      aCenter: gl.getAttribLocation(this.circleProg, \"a_center\"),\n      aOffset: gl.getAttribLocation(this.circleProg, \"a_offset\"),\n      aRadius: gl.getAttribLocation(this.circleProg, \"a_radius\"),\n      aColor: gl.getAttribLocation(this.circleProg, \"a_color\"),\n      uRes: gl.getUniformLocation(this.circleProg, \"u_res\")!,\n      uShake: gl.getUniformLocation(this.circleProg, \"u_shake\")!,\n    };\n\n    this.bgProg = linkProgram(gl, SCREEN_VS, BG_FS);\n    this.glowProg = linkProgram(gl, SCREEN_VS, GLOW_FS);\n    this.extractProg = linkProgram(gl, SCREEN_VS, EXTRACT_FS);\n    this.blurProg = linkProgram(gl, SCREEN_VS, BLUR_FS);\n    this.finalProg = linkProgram(gl, SCREEN_VS, FINAL_FS);\n\n    // --- Line buffer ---\n    this.lineData = new Float32Array(MAX_LINES * 2 * 6); // 2 verts x 6 floats\n    this.lineVBO = gl.createBuffer()!;\n    this.lineVAO = gl.createVertexArray()!;\n    gl.bindVertexArray(this.lineVAO);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.lineVBO);\n    gl.bufferData(gl.ARRAY_BUFFER, this.lineData.byteLength, gl.DYNAMIC_DRAW);\n    const Lstride = 6 * 4;\n    gl.enableVertexAttribArray(this.flatLocs.aPos);\n    gl.vertexAttribPointer(this.flatLocs.aPos, 2, gl.FLOAT, false, Lstride, 0);\n    gl.enableVertexAttribArray(this.flatLocs.aColor);\n    gl.vertexAttribPointer(this.flatLocs.aColor, 4, gl.FLOAT, false, Lstride, 8);\n    gl.bindVertexArray(null);\n\n    // --- Circle buffer ---\n    // Per vertex: center(2) + offset(2) + radius(1) + color(4) = 9 floats\n    this.circleData = new Float32Array(MAX_CIRCLES * 6 * 9);\n    this.circleVBO = gl.createBuffer()!;\n    this.circleVAO = gl.createVertexArray()!;\n    gl.bindVertexArray(this.circleVAO);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.circleVBO);\n    gl.bufferData(gl.ARRAY_BUFFER, this.circleData.byteLength, gl.DYNAMIC_DRAW);\n    const CSTRIDE = 9 * 4;\n    gl.enableVertexAttribArray(this.circleLocs.aCenter);\n    gl.vertexAttribPointer(this.circleLocs.aCenter, 2, gl.FLOAT, false, CSTRIDE, 0);\n    gl.enableVertexAttribArray(this.circleLocs.aOffset);\n    gl.vertexAttribPointer(this.circleLocs.aOffset, 2, gl.FLOAT, false, CSTRIDE, 8);\n    gl.enableVertexAttribArray(this.circleLocs.aRadius);\n    gl.vertexAttribPointer(this.circleLocs.aRadius, 1, gl.FLOAT, false, CSTRIDE, 16);\n    gl.enableVertexAttribArray(this.circleLocs.aColor);\n    gl.vertexAttribPointer(this.circleLocs.aColor, 4, gl.FLOAT, false, CSTRIDE, 20);\n    gl.bindVertexArray(null);\n\n    // --- Fullscreen quad ---\n    this.quadVAO = gl.createVertexArray()!;\n    const quadVBO = gl.createBuffer()!;\n    gl.bindVertexArray(this.quadVAO);\n    gl.bindBuffer(gl.ARRAY_BUFFER, quadVBO);\n    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]), gl.STATIC_DRAW);\n    gl.enableVertexAttribArray(0);\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n    gl.bindVertexArray(null);\n\n    // --- FBOs (will be sized in resize()) ---\n    this.sceneFBO = createFBO(gl, 2, 2);\n    this.bloomFBO = [createFBO(gl, 2, 2), createFBO(gl, 2, 2)];\n\n    // --- Init ---\n    this.resize();\n    window.addEventListener(\"resize\", () => this.resize());\n    this.initTunnel();\n  }\n\n  // =========================================================================\n  // Resize\n  // =========================================================================\n\n  resize(): void {\n    this.dpr = window.devicePixelRatio || 1;\n    this.w = window.innerWidth;\n    this.h = window.innerHeight;\n    const pw = this.w * this.dpr;\n    const ph = this.h * this.dpr;\n\n    // WebGL canvas\n    this.glCanvas.width = pw;\n    this.glCanvas.height = ph;\n    this.gl.viewport(0, 0, pw, ph);\n\n    // HUD canvas\n    this.hudCanvas.width = pw;\n    this.hudCanvas.height = ph;\n    this.hud.setTransform(this.dpr, 0, 0, this.dpr, 0, 0);\n\n    // Resize FBOs\n    resizeFBO(this.gl, this.sceneFBO, pw, ph);\n    const bw = Math.max(1, Math.floor(pw / 2));\n    const bh = Math.max(1, Math.floor(ph / 2));\n    resizeFBO(this.gl, this.bloomFBO[0], bw, bh);\n    resizeFBO(this.gl, this.bloomFBO[1], bw, bh);\n  }\n\n  // =========================================================================\n  // Coordinate helpers\n  // =========================================================================\n\n  private px(nx: number): number { return nx * this.w; }\n  private py(ny: number): number { return ny * this.h; }\n  private ps(ns: number): number { return ns * Math.min(this.w, this.h); }\n  private perspScale(z: number): number { return 1 / (1 + z * FAR_Z); }\n\n  // =========================================================================\n  // Batch: Lines\n  // =========================================================================\n\n  private addLine(x1: number, y1: number, x2: number, y2: number,\n                  r: number, g: number, b: number, a: number): void {\n    if (this.lineCount >= MAX_LINES) return;\n    const i = this.lineCount * 12;\n    this.lineData[i]   = x1; this.lineData[i+1] = y1;\n    this.lineData[i+2] = r;  this.lineData[i+3] = g;\n    this.lineData[i+4] = b;  this.lineData[i+5] = a;\n    this.lineData[i+6] = x2; this.lineData[i+7] = y2;\n    this.lineData[i+8] = r;  this.lineData[i+9] = g;\n    this.lineData[i+10]= b;  this.lineData[i+11]= a;\n    this.lineCount++;\n  }\n\n  /** Add a ring outline (polygon) as line segments. */\n  private addRing(cx: number, cy: number, radius: number,\n                  r: number, g: number, b: number, a: number, sides = RING_SEGMENTS): void {\n    for (let i = 0; i < sides; i++) {\n      const a1 = (i / sides) * Math.PI * 2;\n      const a2 = ((i + 1) / sides) * Math.PI * 2;\n      this.addLine(\n        cx + Math.cos(a1) * radius, cy + Math.sin(a1) * radius,\n        cx + Math.cos(a2) * radius, cy + Math.sin(a2) * radius,\n        r, g, b, a\n      );\n    }\n  }\n\n  private flushLines(): void {\n    if (this.lineCount === 0) return;\n    const gl = this.gl;\n    gl.useProgram(this.flatProg);\n    gl.uniform2f(this.flatLocs.uRes, this.w, this.h);\n    gl.uniform2f(this.flatLocs.uShake, this.shakeX, this.shakeY);\n    gl.bindVertexArray(this.lineVAO);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.lineVBO);\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.lineData.subarray(0, this.lineCount * 12));\n    gl.drawArrays(gl.LINES, 0, this.lineCount * 2);\n    gl.bindVertexArray(null);\n    this.lineCount = 0;\n  }\n\n  // =========================================================================\n  // Batch: Circles (filled, with SDF antialiased edge)\n  // =========================================================================\n\n  private addCircle(cx: number, cy: number, radius: number,\n                    r: number, g: number, b: number, a: number): void {\n    if (this.circleCount >= MAX_CIRCLES) return;\n    const offsets: [number, number][] = [[-1,-1],[1,-1],[1,1],[-1,-1],[1,1],[-1,1]];\n    const base = this.circleCount * 54; // 6 verts x 9 floats\n    for (let v = 0; v < 6; v++) {\n      const o = base + v * 9;\n      this.circleData[o]   = cx;\n      this.circleData[o+1] = cy;\n      this.circleData[o+2] = offsets[v][0];\n      this.circleData[o+3] = offsets[v][1];\n      this.circleData[o+4] = radius;\n      this.circleData[o+5] = r;\n      this.circleData[o+6] = g;\n      this.circleData[o+7] = b;\n      this.circleData[o+8] = a;\n    }\n    this.circleCount++;\n  }\n\n  private flushCircles(): void {\n    if (this.circleCount === 0) return;\n    const gl = this.gl;\n    gl.useProgram(this.circleProg);\n    gl.uniform2f(this.circleLocs.uRes, this.w, this.h);\n    gl.uniform2f(this.circleLocs.uShake, this.shakeX, this.shakeY);\n    gl.bindVertexArray(this.circleVAO);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.circleVBO);\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, this.circleData.subarray(0, this.circleCount * 54));\n    gl.drawArrays(gl.TRIANGLES, 0, this.circleCount * 6);\n    gl.bindVertexArray(null);\n    this.circleCount = 0;\n  }\n\n  // =========================================================================\n  // Fullscreen quad draw\n  // =========================================================================\n\n  private drawQuad(prog: WebGLProgram): void {\n    const gl = this.gl;\n    gl.useProgram(prog);\n    gl.bindVertexArray(this.quadVAO);\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.bindVertexArray(null);\n  }\n\n  // =========================================================================\n  // Tunnel init & animation\n  // =========================================================================\n\n  private initTunnel(): void {\n    this.rings = [];\n    for (let i = 0; i < RING_COUNT; i++) {\n      this.rings.push(i / RING_COUNT);\n    }\n    this.streaks = [];\n    for (let i = 0; i < STREAK_COUNT; i++) {\n      this.streaks.push({\n        angle: Math.random() * Math.PI * 2,\n        radius: TUNNEL_RADIUS * (0.5 + Math.random() * 0.5),\n        z: Math.random(),\n        speed: 0.4 + Math.random() * 0.6,\n        brightness: 0.4 + Math.random() * 0.6,\n      });\n    }\n  }\n\n  private updateTunnel(dt: number, energy: number, cursor: Vec2): void {\n    const targetSpeed = 0.2 + energy * 0.8;\n    this.tunnelSpeed += (targetSpeed - this.tunnelSpeed) * Math.min(dt * 3, 1);\n    const spd = this.tunnelSpeed;\n\n    for (let i = 0; i < this.rings.length; i++) {\n      this.rings[i] -= spd * dt;\n      if (this.rings[i] < 0) this.rings[i] += 1;\n    }\n\n    for (const s of this.streaks) {\n      s.z -= s.speed * spd * dt;\n      if (s.z < 0.02) {\n        s.z = 0.8 + Math.random() * 0.2;\n        s.angle = Math.random() * Math.PI * 2;\n        s.brightness = 0.4 + Math.random() * 0.6;\n      }\n    }\n\n    // Smoothly move camera offset toward cursor for parallax\n    const targetCamX = (cursor.x - 0.5) * PARALLAX_STRENGTH;\n    const targetCamY = (cursor.y - 0.5) * PARALLAX_STRENGTH;\n    const camSmooth = 1 - Math.exp(-6 * dt);\n    this.camOffX += (targetCamX - this.camOffX) * camSmooth;\n    this.camOffY += (targetCamY - this.camOffY) * camSmooth;\n  }\n\n  private updateShake(dt: number, game: Game): void {\n    for (const effect of game.effects) {\n      if (effect.type === \"damage\" && effect.life > effect.maxLife - 0.05) {\n        const intensity = this.ps(0.02);\n        this.shakeX = (Math.random() - 0.5) * intensity * 2;\n        this.shakeY = (Math.random() - 0.5) * intensity * 2;\n        this.shakeDecay = 0.3;\n      }\n    }\n    if (this.shakeDecay > 0) {\n      this.shakeDecay -= dt;\n      const decay = Math.max(0, this.shakeDecay / 0.3);\n      this.shakeX *= decay;\n      this.shakeY *= decay;\n      if (this.shakeDecay <= 0) { this.shakeX = 0; this.shakeY = 0; }\n    }\n  }\n\n  // =========================================================================\n  // Energy lookup\n  // =========================================================================\n\n  private getEnergy(game: Game): number {\n    const tl = game.beatmap.energyTimeline;\n    if (!tl || tl.length === 0) {\n      const p = game.time / game.beatmap.duration;\n      return 0.2 + p * 0.6;\n    }\n    const t = game.time;\n    if (t < (tl[this.energyIdx]?.time ?? 0)) this.energyIdx = 0;\n    while (this.energyIdx < tl.length - 1 && tl[this.energyIdx + 1].time <= t) {\n      this.energyIdx++;\n    }\n    if (this.energyIdx >= tl.length - 1) return tl[tl.length - 1].energy;\n    const a = tl[this.energyIdx], b = tl[this.energyIdx + 1];\n    const f = (t - a.time) / (b.time - a.time);\n    return a.energy + (b.energy - a.energy) * f;\n  }\n\n  // =========================================================================\n  // Main render\n  // =========================================================================\n\n  render(game: Game, cursor: Vec2, musicMuted = false,\n         landmarks: HandLandmark[] | null = null, cursorLandmarkIdx = 8,\n         clampMin = 0.25, clampMax = 0.75,\n         gesture: GestureSample = { lanesPressed: [false, false, false, false] }): void {\n    const gl = this.gl;\n    const now = performance.now() / 1000;\n    const dt = this.lastRenderTime\n      ? Math.min(now - this.lastRenderTime, 0.1)\n      : 1 / 60;\n    this.lastRenderTime = now;\n\n    // Determine phase-specific parameters\n    let energy = 0.15, hue = 220;\n    let drawLanesFlag = false, drawCursorFlag = false;\n    let drawEffectsFlag = false, drawHUDFlag = false;\n\n    if (game.phase === \"menu\") {\n      energy = 0.15; hue = 220;\n    } else if (game.phase === \"countdown\") {\n      energy = 0.3; hue = 230;\n      drawCursorFlag = true;\n    } else if (game.phase === \"results\") {\n      energy = 0.1; hue = 260;\n    } else if (game.phase === \"gameover\") {\n      energy = 0.05; hue = 0;\n    } else {\n      // playing\n      energy = this.getEnergy(game);\n      const progress = game.time / game.beatmap.duration;\n      hue = 220 + energy * 40 + progress * 20;\n      drawLanesFlag = true;\n      drawCursorFlag = true;\n      drawEffectsFlag = true;\n      drawHUDFlag = true;\n    }\n\n    this.updateTunnel(dt, energy, cursor);\n    if (game.phase === \"playing\") this.updateShake(dt, game);\n\n    // ---------------------------------------------------------------\n    // Pass 1: Render scene to FBO\n    // ---------------------------------------------------------------\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.sceneFBO.fb);\n    gl.viewport(0, 0, this.sceneFBO.w, this.sceneFBO.h);\n    gl.clearColor(0.024, 0.024, 0.047, 1.0);\n    gl.clear(gl.COLOR_BUFFER_BIT);\n\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n\n    // Background gradient\n    this.drawBackground(energy, hue);\n\n    // Vanishing point glow\n    this.drawVanishingGlow(energy, hue);\n\n    // Tunnel mesh (lines) \u2014 drawn with camera shake\n    this.drawTunnelMesh(energy, hue);\n\n    // Game objects\n    if (drawLanesFlag) this.drawLanesGL(game, gesture);\n    if (drawCursorFlag) this.drawCursorGL(cursor);\n    if (drawEffectsFlag) this.drawEffectsGL(game);\n\n    // Flush remaining batched geometry\n    this.flushLines();\n    this.flushCircles();\n\n    // Energy bloom overlay\n    if (energy > 0.55) {\n      const bloom = (energy - 0.55) * 2.2;\n      const [cr, cg, cb] = hsl(hue, 0.8, 0.4);\n      this.drawOverlayRect(cr, cg, cb, bloom * 0.06);\n    }\n\n    // Phase-specific overlays (dim backgrounds for menu/results/gameover)\n    if (game.phase === \"menu\") {\n      this.drawOverlayRect(0.024, 0.024, 0.047, 0.5);\n    } else if (game.phase === \"results\") {\n      this.drawOverlayRect(0.024, 0.024, 0.047, 0.7);\n    } else if (game.phase === \"gameover\") {\n      this.drawGameOverVignette();\n    }\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n\n    // ---------------------------------------------------------------\n    // Pass 2: Bloom\n    // ---------------------------------------------------------------\n    this.applyBloom();\n\n    // ---------------------------------------------------------------\n    // Pass 3: Final composite to screen\n    // ---------------------------------------------------------------\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    gl.viewport(0, 0, this.glCanvas.width, this.glCanvas.height);\n\n    gl.useProgram(this.finalProg);\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this.sceneFBO.tex);\n    gl.uniform1i(gl.getUniformLocation(this.finalProg, \"u_scene\"), 0);\n    gl.activeTexture(gl.TEXTURE1);\n    gl.bindTexture(gl.TEXTURE_2D, this.bloomFBO[0].tex);\n    gl.uniform1i(gl.getUniformLocation(this.finalProg, \"u_bloom\"), 1);\n    gl.uniform1f(gl.getUniformLocation(this.finalProg, \"u_bloomStr\"), 0.6 + energy * 0.8);\n    gl.uniform1f(gl.getUniformLocation(this.finalProg, \"u_scanStr\"), 0.07);\n    gl.uniform1f(gl.getUniformLocation(this.finalProg, \"u_vigStr\"), 0.35);\n    this.drawQuad(this.finalProg);\n\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.activeTexture(gl.TEXTURE1);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n\n    // ---------------------------------------------------------------\n    // Pass 4: HUD overlay (Canvas 2D)\n    // ---------------------------------------------------------------\n    this.hud.clearRect(0, 0, this.w, this.h);\n\n    if (game.phase === \"menu\") {\n      this.drawMenuHUD();\n    } else if (game.phase === \"countdown\") {\n      this.drawCountdownHUD(game);\n    } else if (game.phase === \"results\") {\n      this.drawResultsHUD(game);\n    } else if (game.phase === \"gameover\") {\n      this.drawGameOverHUD(game);\n    }\n\n    if (drawHUDFlag) {\n      this.drawPlayingHUD(game, musicMuted, energy, gesture);\n    }\n\n    // Camera debug overlay (landmarks drawn on mini camera canvas)\n    this.drawCamDebugOverlay(landmarks, cursorLandmarkIdx, clampMin, clampMax);\n  }\n\n  // =========================================================================\n  // Scene: Background\n  // =========================================================================\n\n  private drawBackground(energy: number, hue: number): void {\n    const gl = this.gl;\n    const [cr, cg, cb] = hsl(hue, 0.4, 0.06 + energy * 0.05);\n    const [er, eg, eb] = hsl(hue + 30, 0.25, 0.02 + energy * 0.02);\n\n    gl.useProgram(this.bgProg);\n    gl.uniform3f(gl.getUniformLocation(this.bgProg, \"u_cCenter\"), cr, cg, cb);\n    gl.uniform3f(gl.getUniformLocation(this.bgProg, \"u_cEdge\"), er, eg, eb);\n    gl.uniform1f(gl.getUniformLocation(this.bgProg, \"u_aspect\"), this.w / this.h);\n    this.drawQuad(this.bgProg);\n  }\n\n  private drawVanishingGlow(energy: number, hue: number): void {\n    const gl = this.gl;\n    const [r, g, b] = hsl(hue, 0.6, 0.4 + energy * 0.3);\n    const minDim = Math.min(this.w, this.h);\n    const vpR = minDim * (0.08 + energy * 0.12);\n    const normRadius = vpR / minDim;\n\n    gl.useProgram(this.glowProg);\n    gl.uniform3f(gl.getUniformLocation(this.glowProg, \"u_color\"), r, g, b);\n    gl.uniform1f(gl.getUniformLocation(this.glowProg, \"u_alpha\"), 0.3 + energy * 0.4);\n    gl.uniform1f(gl.getUniformLocation(this.glowProg, \"u_radius\"), normRadius);\n    gl.uniform1f(gl.getUniformLocation(this.glowProg, \"u_aspect\"), this.w / this.h);\n    this.drawQuad(this.glowProg);\n  }\n\n  // =========================================================================\n  // Scene: Overlay rectangles\n  // =========================================================================\n\n  private drawOverlayRect(r: number, g: number, b: number, a: number): void {\n    this.flushLines();\n    this.flushCircles();\n\n    const gl = this.gl;\n    gl.useProgram(this.flatProg);\n    gl.uniform2f(this.flatLocs.uRes, this.w, this.h);\n    gl.uniform2f(this.flatLocs.uShake, 0, 0);\n\n    const w = this.w, h = this.h;\n    const d = this.lineData;\n    let o = 0;\n    d[o++]=0; d[o++]=0; d[o++]=r; d[o++]=g; d[o++]=b; d[o++]=a;\n    d[o++]=w; d[o++]=0; d[o++]=r; d[o++]=g; d[o++]=b; d[o++]=a;\n    d[o++]=0; d[o++]=h; d[o++]=r; d[o++]=g; d[o++]=b; d[o++]=a;\n    d[o++]=w; d[o++]=0; d[o++]=r; d[o++]=g; d[o++]=b; d[o++]=a;\n    d[o++]=w; d[o++]=h; d[o++]=r; d[o++]=g; d[o++]=b; d[o++]=a;\n    d[o++]=0; d[o++]=h; d[o++]=r; d[o++]=g; d[o++]=b; d[o++]=a;\n\n    gl.bindVertexArray(this.lineVAO);\n    gl.bindBuffer(gl.ARRAY_BUFFER, this.lineVBO);\n    gl.bufferSubData(gl.ARRAY_BUFFER, 0, d.subarray(0, 36));\n    gl.drawArrays(gl.TRIANGLES, 0, 6);\n    gl.bindVertexArray(null);\n  }\n\n  private drawGameOverVignette(): void {\n    const gl = this.gl;\n    gl.useProgram(this.glowProg);\n    this.drawOverlayRect(0.16, 0, 0, 0.85);\n    gl.useProgram(this.glowProg);\n    gl.uniform3f(gl.getUniformLocation(this.glowProg, \"u_color\"), 0.0, 0.0, 0.0);\n    gl.uniform1f(gl.getUniformLocation(this.glowProg, \"u_alpha\"), 0.5);\n    gl.uniform1f(gl.getUniformLocation(this.glowProg, \"u_radius\"), 0.5);\n    gl.uniform1f(gl.getUniformLocation(this.glowProg, \"u_aspect\"), this.w / this.h);\n    gl.blendFunc(gl.ONE, gl.ONE);\n    gl.blendEquation(gl.FUNC_REVERSE_SUBTRACT);\n    this.drawQuad(this.glowProg);\n    gl.blendEquation(gl.FUNC_ADD);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n  }\n\n  // =========================================================================\n  // Scene: Tunnel mesh\n  // =========================================================================\n\n  /** Project a 3D tunnel point to 2D screen coords with parallax camera offset. */\n  private tunnelProject(x3d: number, y3d: number, z: number): [number, number] {\n    const scale = this.perspScale(z);\n    const vpX = this.w / 2 + this.camOffX * this.w * (1 - scale);\n    const vpY = this.h / 2 + this.camOffY * this.h * (1 - scale);\n    return [\n      vpX + x3d * scale * Math.min(this.w, this.h),\n      vpY + y3d * scale * Math.min(this.w, this.h),\n    ];\n  }\n\n  private drawTunnelMesh(energy: number, hue: number): void {\n    const minDim = Math.min(this.w, this.h);\n\n    const sortedZ = [...this.rings].sort((a, b) => a - b);\n\n    const halfW = TUNNEL_RADIUS * 0.7;\n    const halfH = TUNNEL_RADIUS * 0.5;\n    const corners: [number, number][] = [\n      [-halfW, -halfH], [halfW, -halfH],\n      [halfW, halfH], [-halfW, halfH],\n    ];\n\n    // --- Rectangular rings flying toward the user ---\n    for (const z of this.rings) {\n      const scale = this.perspScale(z);\n      const screenR = minDim * TUNNEL_RADIUS * scale;\n      if (screenR < 2) continue;\n\n      const proximity = Math.max(0, 1 - z);\n      const alpha = Math.min(scale * 2, 1) * (0.15 + energy * 0.45) * (0.3 + proximity * 0.7);\n      const lightness = 0.35 + energy * 0.35 + proximity * 0.1;\n      const sat = 0.5 + energy * 0.3;\n      const [rr, rg, rb] = hsl(hue + z * 30, sat, lightness);\n\n      const rotOffset = z * Math.PI * 0.08;\n      const cosR = Math.cos(rotOffset);\n      const sinR = Math.sin(rotOffset);\n\n      const projected: [number, number][] = [];\n      for (const [cx, cy] of corners) {\n        const rx = cx * cosR - cy * sinR;\n        const ry = cx * sinR + cy * cosR;\n        projected.push(this.tunnelProject(rx, ry, z));\n      }\n\n      for (let i = 0; i < SIDES; i++) {\n        const [x1, y1] = projected[i];\n        const [x2, y2] = projected[(i + 1) % SIDES];\n        this.addLine(x1, y1, x2, y2, rr, rg, rb, alpha);\n      }\n\n      if (proximity > 0.6) {\n        const dotAlpha = alpha * 1.5 * (proximity - 0.6) / 0.4;\n        for (const [px, py] of projected) {\n          this.addLine(px - 1, py, px + 1, py, 1, 1, 1, dotAlpha);\n        }\n      }\n    }\n\n    // --- Longitudinal mesh lines ---\n    const [lr, lg, lb] = hsl(hue + 15, 0.4, 0.3 + energy * 0.3);\n    const maxGap = 1.8 / RING_COUNT;\n    for (let j = 0; j < sortedZ.length - 1; j++) {\n      const z1 = sortedZ[j];\n      const z2 = sortedZ[j + 1];\n      if (z2 - z1 > maxGap) continue;\n\n      const s1 = this.perspScale(z1);\n      const s2 = this.perspScale(z2);\n      if (minDim * TUNNEL_RADIUS * s1 < 2 || minDim * TUNNEL_RADIUS * s2 < 2) continue;\n\n      const prox = Math.max(0, 1 - Math.min(z1, z2));\n      const alpha = Math.min(Math.min(s1, s2) * 2, 1) * (0.08 + energy * 0.25) * (0.3 + prox * 0.7);\n\n      const rot1 = z1 * Math.PI * 0.08;\n      const rot2 = z2 * Math.PI * 0.08;\n      const cos1 = Math.cos(rot1), sin1 = Math.sin(rot1);\n      const cos2 = Math.cos(rot2), sin2 = Math.sin(rot2);\n\n      for (let i = 0; i < SIDES; i++) {\n        const [cx1, cy1] = corners[i];\n        const rx1 = cx1 * cos1 - cy1 * sin1;\n        const ry1 = cx1 * sin1 + cy1 * cos1;\n        const [px1, py1] = this.tunnelProject(rx1, ry1, z1);\n\n        const [cx2, cy2] = corners[i];\n        const rx2 = cx2 * cos2 - cy2 * sin2;\n        const ry2 = cx2 * sin2 + cy2 * cos2;\n        const [px2, py2] = this.tunnelProject(rx2, ry2, z2);\n\n        this.addLine(px1, py1, px2, py2, lr, lg, lb, alpha);\n      }\n    }\n\n    // --- Perspective guide lines ---\n    const vpX = this.w / 2 + this.camOffX * this.w;\n    const vpY = this.h / 2 + this.camOffY * this.h;\n    const [glR, glG, glB] = hsl(hue, 0.4, 0.25);\n    const glA = 0.05 + energy * 0.08;\n    const edgeTargets: [number, number][] = [\n      [0, 0], [this.w, 0], [this.w, this.h], [0, this.h],\n    ];\n    for (const [ex, ey] of edgeTargets) {\n      this.addLine(vpX, vpY, ex, ey, glR, glG, glB, glA);\n    }\n\n    // --- Speed streaks ---\n    for (const s of this.streaks) {\n      const [sx, sy] = this.tunnelProject(\n        Math.cos(s.angle) * s.radius,\n        Math.sin(s.angle) * s.radius,\n        s.z,\n      );\n\n      const trailZ = s.z + 0.05;\n      const [tx, ty] = this.tunnelProject(\n        Math.cos(s.angle) * s.radius,\n        Math.sin(s.angle) * s.radius,\n        trailZ,\n      );\n\n      const scale = this.perspScale(s.z);\n      const alpha = s.brightness * scale * (0.25 + energy * 0.75);\n      if (alpha < 0.01) continue;\n\n      const [sr, sg, sb] = hsl(hue - 10, 0.5, 0.85);\n      this.addLine(tx, ty, sx, sy, sr, sg, sb, alpha);\n    }\n\n    this.flushLines();\n  }\n\n  // =========================================================================\n  // Scene: Lane-based game objects\n  // =========================================================================\n\n  /** Draw 4 lane tracks, hit zones, and approaching bullets. */\n  private drawLanesGL(game: Game, gesture: GestureSample): void {\n    const cx = this.w / 2;\n    const cy = this.h / 2;\n    const hitY = this.py(LANE_HIT_Y);\n    const hitR = this.ps(0.035); // hit zone circle radius\n\n    // --- Draw lane track lines from vanishing point to hit zone ---\n    for (let i = 0; i < LANE_COUNT; i++) {\n      const laneX = this.px(LANE_CENTERS[i]);\n      const [cr, cg, cb] = LANE_COLORS[i];\n\n      // Faint lane track line\n      this.addLine(cx, cy, laneX, hitY, cr, cg, cb, 0.08);\n\n      // Hit zone circle\n      const pressed = gesture.lanesPressed[i];\n      const hitAlpha = pressed ? 0.7 : 0.2;\n      const hitGlow = pressed ? hitR * 1.8 : hitR * 1.2;\n\n      // Outer glow\n      this.addCircle(laneX, hitY, hitGlow, cr, cg, cb, hitAlpha * 0.3);\n      // Hit zone ring\n      this.addRing(laneX, hitY, hitR, cr, cg, cb, hitAlpha, 16);\n      // Center dot\n      this.addCircle(laneX, hitY, hitR * 0.25, cr, cg, cb, hitAlpha);\n    }\n\n    // --- Draw approaching bullets ---\n    for (const slash of game.slashes) {\n      const timeDiff = game.time - slash.time;\n      const approachProgress = 1 - (slash.time - game.time) / slash.approachTime;\n      if (approachProgress < 0) continue;\n\n      const laneX = this.px(LANE_CENTERS[slash.lane]);\n      const [cr, cg, cb] = LANE_COLORS[slash.lane] ?? [1, 1, 1];\n      const baseR = this.ps(0.03);\n\n      // --- Hit: expanding ring + core flash ---\n      if (slash.hit) {\n        const hitP = Math.max(0, timeDiff) / 0.35;\n        if (hitP > 1) continue;\n        const alpha = 1 - hitP;\n\n        // Expanding ring at hit zone\n        const ringR = hitR * (1 + hitP * 3);\n        this.addRing(laneX, hitY, ringR, cr, cg, cb, alpha * 0.7, 20);\n\n        // Core flash (bright white)\n        const coreR = hitR * (1 - hitP * 0.5);\n        this.addCircle(laneX, hitY, Math.max(2, coreR), 1, 1, 1, alpha * 0.9);\n\n        // Inner colored ring\n        this.addRing(laneX, hitY, ringR * 0.5, cr, cg, cb, alpha * 0.4, 12);\n        continue;\n      }\n\n      // --- Miss: collapsing red ring ---\n      if (slash.missed) {\n        const missP = Math.max(0, timeDiff - 0.25) / 0.5;\n        if (missP > 1) continue;\n        const alpha = Math.max(0, 1 - missP) * 0.3;\n        const collapseR = hitR * (1 - missP * 0.6);\n        this.addRing(laneX, hitY, collapseR, ...COL.miss, alpha, 12);\n        this.addCircle(laneX, hitY, collapseR * 0.4, ...COL.miss, alpha * 0.5);\n        continue;\n      }\n\n      // --- Active: bullet approaching from vanishing point to hit zone ---\n      const clamped = Math.min(approachProgress, 1);\n      const z = 1 - clamped;\n      const scale = this.perspScale(z);\n\n      // Interpolate from center to lane hit position\n      const displayX = cx + (laneX - cx) * scale;\n      const displayY = cy + (hitY - cy) * scale;\n      const displayR = Math.max(3, baseR * scale);\n\n      const nearWindow = Math.abs(timeDiff) <= GOOD_WINDOW;\n      const pulse = nearWindow ? (1 + Math.sin(game.time * 14) * 0.15) : 1;\n\n      // Landing zone indicator at hit position\n      const landingAlpha = clamped * clamped * 0.55;\n      if (landingAlpha > 0.02 && nearWindow) {\n        this.addRing(laneX, hitY, hitR * 1.4 * pulse, cr, cg, cb, landingAlpha * 0.5, 12);\n      }\n\n      // Connecting trail from bullet to hit zone\n      if (clamped < 0.88) {\n        const connAlpha = (1 - clamped) * 0.08;\n        this.addLine(displayX, displayY, laneX, hitY, cr, cg, cb, connAlpha);\n      }\n\n      // Plasma bullet layers\n      this.addCircle(displayX, displayY, displayR * 3.2 * pulse, cr, cg, cb, landingAlpha * 0.12);\n      this.addCircle(displayX, displayY, displayR * 1.8 * pulse, cr, cg, cb, Math.min(clamped * 1.2, 0.6));\n      this.addCircle(displayX, displayY, displayR * pulse, cr, cg, cb, Math.min(clamped * 1.5, 0.85));\n      this.addCircle(displayX, displayY, displayR * 0.35, 1, 1, 1, Math.min(clamped * 2, 1));\n    }\n  }\n\n  // =========================================================================\n  // Scene: Cursor\n  // =========================================================================\n\n  private drawCursorGL(cursor: Vec2): void {\n    const cursorX = this.px(cursor.x);\n    const cursorY = this.py(cursor.y);\n    const r = this.ps(0.025);\n\n    // Layered glow\n    this.addCircle(cursorX, cursorY, r * 4, ...COL.cursor, 0.08);\n    this.addCircle(cursorX, cursorY, r * 2.2, ...COL.cursor, 0.2);\n    this.addCircle(cursorX, cursorY, r * 1.4, ...COL.cursor, 0.45);\n    // Core\n    this.addCircle(cursorX, cursorY, r, 1, 1, 1, 1);\n    // Center dot\n    this.addCircle(cursorX, cursorY, r * 0.3, ...COL.cursor, 1);\n  }\n\n  // =========================================================================\n  // Scene: Effects\n  // =========================================================================\n\n  private drawEffectsGL(game: Game): void {\n    for (const effect of game.effects) {\n      const progress = 1 - effect.life / effect.maxLife;\n      const alpha = 1 - progress;\n      const ex = this.px(effect.x);\n      const ey = this.py(effect.y);\n\n      if (effect.type === \"perfect\" || effect.type === \"good\") {\n        const col = effect.type === \"perfect\" ? COL.perfect : COL.good;\n        const r = this.ps(0.04 + progress * 0.1);\n        this.addRing(ex, ey, r, ...col, alpha * 0.6, 16);\n      }\n\n      if (effect.type === \"damage\") {\n        const r = this.ps(progress * 0.12);\n        this.addCircle(ex, ey, r, ...COL.miss, alpha * 0.4);\n        this.flushLines();\n        this.flushCircles();\n        this.drawOverlayRect(1, 0, 0, alpha * 0.18);\n      }\n\n      if (effect.type === \"combo_milestone\") {\n        this.flushLines();\n        this.flushCircles();\n        this.drawOverlayRect(...COL.cursor, alpha * 0.08);\n      }\n    }\n  }\n\n  // =========================================================================\n  // Bloom pipeline\n  // =========================================================================\n\n  private applyBloom(): void {\n    const gl = this.gl;\n    gl.disable(gl.BLEND);\n\n    gl.bindFramebuffer(gl.FRAMEBUFFER, this.bloomFBO[0].fb);\n    gl.viewport(0, 0, this.bloomFBO[0].w, this.bloomFBO[0].h);\n    gl.useProgram(this.extractProg);\n    gl.activeTexture(gl.TEXTURE0);\n    gl.bindTexture(gl.TEXTURE_2D, this.sceneFBO.tex);\n    gl.uniform1i(gl.getUniformLocation(this.extractProg, \"u_tex\"), 0);\n    gl.uniform1f(gl.getUniformLocation(this.extractProg, \"u_threshold\"), 0.3);\n    this.drawQuad(this.extractProg);\n\n    for (let pass = 0; pass < 2; pass++) {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.bloomFBO[1].fb);\n      gl.useProgram(this.blurProg);\n      gl.activeTexture(gl.TEXTURE0);\n      gl.bindTexture(gl.TEXTURE_2D, this.bloomFBO[0].tex);\n      gl.uniform1i(gl.getUniformLocation(this.blurProg, \"u_tex\"), 0);\n      gl.uniform2f(gl.getUniformLocation(this.blurProg, \"u_dir\"), 1.0 / this.bloomFBO[0].w, 0);\n      this.drawQuad(this.blurProg);\n\n      gl.bindFramebuffer(gl.FRAMEBUFFER, this.bloomFBO[0].fb);\n      gl.bindTexture(gl.TEXTURE_2D, this.bloomFBO[1].tex);\n      gl.uniform2f(gl.getUniformLocation(this.blurProg, \"u_dir\"), 0, 1.0 / this.bloomFBO[0].h);\n      this.drawQuad(this.blurProg);\n    }\n\n    gl.enable(gl.BLEND);\n    gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n    gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n  }\n\n  // =========================================================================\n  // HUD: Neon glow text helper\n  // =========================================================================\n\n  private glowText(text: string, x: number, y: number, color: string, fontSize: number,\n                   bold = false, glowSize = 0): void {\n    const ctx = this.hud;\n    const weight = bold ? \"bold \" : \"\";\n    ctx.font = `${weight}${fontSize}px 'Orbitron', sans-serif`;\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n\n    if (glowSize > 0) {\n      ctx.save();\n      ctx.shadowColor = color;\n      ctx.shadowBlur = glowSize;\n      ctx.fillStyle = color;\n      ctx.fillText(text, x, y);\n      ctx.fillText(text, x, y);\n      ctx.restore();\n    }\n\n    ctx.fillStyle = color;\n    ctx.fillText(text, x, y);\n  }\n\n  // =========================================================================\n  // HUD: Playing phase\n  // =========================================================================\n\n  private drawPlayingHUD(game: Game, musicMuted: boolean, energy: number, gesture: GestureSample): void {\n    const ctx = this.hud;\n    const pad = this.ps(0.02);\n    const fontSize = this.ps(0.025);\n\n    // --- Score ---\n    ctx.font = `bold ${fontSize}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#fff\";\n    ctx.textAlign = \"left\";\n    ctx.textBaseline = \"top\";\n    ctx.fillText(`${game.score}`, pad, pad);\n\n    // --- Combo ---\n    if (game.combo > 1) {\n      const comboSize = Math.min(fontSize * (1 + game.combo * 0.01), fontSize * 1.5);\n      ctx.font = `bold ${comboSize}px 'Orbitron', sans-serif`;\n      ctx.fillStyle = \"#0ff\";\n      ctx.fillText(`${game.combo}x`, pad, pad + fontSize + 4);\n    }\n\n    // --- Health bar ---\n    const barW = this.ps(0.12);\n    const barH = this.ps(0.01);\n    const barX = this.w - pad - barW;\n    const barY = pad;\n\n    ctx.fillStyle = \"#222\";\n    ctx.fillRect(barX, barY, barW, barH);\n    ctx.fillStyle = game.health > 30 ? \"#0f0\" : \"#f00\";\n    ctx.fillRect(barX, barY, barW * (game.health / 100), barH);\n    ctx.strokeStyle = \"#444\";\n    ctx.lineWidth = 1;\n    ctx.strokeRect(barX, barY, barW, barH);\n\n    ctx.font = `${this.ps(0.012)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#888\";\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"top\";\n    ctx.fillText(\"HP\", barX - 6, barY);\n\n    // --- Energy indicator ---\n    const eBarY = barY + barH + 3;\n    ctx.fillStyle = \"#111\";\n    ctx.fillRect(barX, eBarY, barW, 3);\n    const eHue = 220 + energy * 60;\n    ctx.fillStyle = `hsla(${eHue}, 70%, 50%, 0.8)`;\n    ctx.fillRect(barX, eBarY, barW * energy, 3);\n\n    // --- Progress bar ---\n    const progress = game.time / game.beatmap.duration;\n    const pBarH = 3;\n    const pBarY = this.h - pBarH;\n    ctx.fillStyle = \"#1a1a2a\";\n    ctx.fillRect(0, pBarY, this.w, pBarH);\n    ctx.fillStyle = \"#336\";\n    ctx.fillRect(0, pBarY, this.w * progress, pBarH);\n\n    // --- Time remaining ---\n    const remaining = Math.max(0, game.beatmap.duration - game.time);\n    const mins = Math.floor(remaining / 60);\n    const secs = Math.floor(remaining % 60);\n    ctx.font = `${this.ps(0.014)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#555\";\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"bottom\";\n    ctx.fillText(`${mins}:${secs.toString().padStart(2, \"0\")}`, this.w - pad, pBarY - 4);\n\n    // --- Lane key labels (A/S/D/F) below hit zones ---\n    const keyLabels = [\"A\", \"S\", \"D\", \"F\"];\n    const labelY = this.py(LANE_HIT_Y) + this.ps(0.06);\n    const labelSize = this.ps(0.022);\n    ctx.font = `bold ${labelSize}px 'Orbitron', sans-serif`;\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    for (let i = 0; i < LANE_COUNT; i++) {\n      const laneX = this.px(LANE_CENTERS[i]);\n      const [cr, cg, cb] = LANE_COLORS[i];\n      const pressed = gesture.lanesPressed[i];\n      ctx.fillStyle = pressed\n        ? `rgba(${Math.round(cr * 255)}, ${Math.round(cg * 255)}, ${Math.round(cb * 255)}, 1)`\n        : `rgba(${Math.round(cr * 255)}, ${Math.round(cg * 255)}, ${Math.round(cb * 255)}, 0.4)`;\n      ctx.fillText(keyLabels[i], laneX, labelY);\n    }\n\n    // --- Mute button ---\n    const btnSize = this.ps(0.03);\n    const btnX = this.w - pad - btnSize;\n    const btnY = eBarY + 6 + pad;\n    this.muteButtonRect = { x: btnX, y: btnY, w: btnSize, h: btnSize };\n\n    ctx.fillStyle = musicMuted ? \"#555\" : \"#888\";\n    ctx.font = `${btnSize * 0.8}px 'Orbitron', sans-serif`;\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillText(\"M\", btnX + btnSize / 2, btnY + btnSize / 2);\n\n    if (musicMuted) {\n      ctx.strokeStyle = \"#f44\";\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.moveTo(btnX + 2, btnY + btnSize - 2);\n      ctx.lineTo(btnX + btnSize - 2, btnY + 2);\n      ctx.stroke();\n    }\n\n    // --- Camera debug toggle button ---\n    const camBtnY = btnY + btnSize + 8;\n    this.camDebugButtonRect = { x: btnX, y: camBtnY, w: btnSize, h: btnSize };\n\n    ctx.fillStyle = this.camDebugVisible ? \"#0ff\" : \"#555\";\n    ctx.font = `${btnSize * 0.7}px 'Orbitron', sans-serif`;\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillText(\"C\", btnX + btnSize / 2, camBtnY + btnSize / 2);\n\n    // --- Power HUD ---\n    this.drawPowerHUD(game, camBtnY + btnSize + 8);\n\n    // --- Effect text (floaters drawn on HUD) ---\n    for (const effect of game.effects) {\n      const prog = 1 - effect.life / effect.maxLife;\n      const alpha = 1 - prog;\n      const ex = this.px(effect.x);\n      const ey = this.py(effect.y);\n\n      if (effect.type === \"perfect\") {\n        ctx.globalAlpha = alpha;\n        ctx.font = `bold ${this.ps(0.022)}px 'Orbitron', sans-serif`;\n        ctx.fillStyle = \"#ff0\";\n        ctx.textAlign = \"center\";\n        ctx.textBaseline = \"middle\";\n        ctx.fillText(\"PERFECT\", ex, ey - this.ps(0.05 + prog * 0.04));\n        ctx.globalAlpha = 1;\n      }\n\n      if (effect.type === \"good\") {\n        ctx.globalAlpha = alpha;\n        ctx.font = `bold ${this.ps(0.022)}px 'Orbitron', sans-serif`;\n        ctx.fillStyle = \"#0f0\";\n        ctx.textAlign = \"center\";\n        ctx.textBaseline = \"middle\";\n        ctx.fillText(\"GOOD\", ex, ey - this.ps(0.05 + prog * 0.04));\n        ctx.globalAlpha = 1;\n      }\n\n      if (effect.type === \"miss\") {\n        ctx.globalAlpha = alpha;\n        ctx.font = `${this.ps(0.018)}px 'Orbitron', sans-serif`;\n        ctx.fillStyle = \"#f44\";\n        ctx.textAlign = \"center\";\n        ctx.textBaseline = \"middle\";\n        ctx.fillText(\"MISS\", ex, ey - this.ps(0.04 + prog * 0.02));\n        ctx.globalAlpha = 1;\n      }\n\n      if (effect.type === \"combo_milestone\") {\n        ctx.globalAlpha = alpha;\n        const comboFontSize = this.ps(0.06 + prog * 0.02);\n        this.glowText(`${effect.value} COMBO!`, this.w / 2, this.h / 2, \"#0ff\", comboFontSize, true, 20);\n        ctx.globalAlpha = 1;\n      }\n    }\n  }\n\n  // =========================================================================\n  // HUD: Power indicator\n  // =========================================================================\n\n  private drawPowerHUD(game: Game, topY: number): void {\n    if (game.power === \"none\") return;\n\n    const ctx = this.hud;\n    const pad = this.ps(0.02);\n    const barW = this.ps(0.12);\n    const barH = this.ps(0.012);\n    const barX = this.w - pad - barW;\n    const barY = topY;\n\n    const POWER_NAMES: Record<string, string> = {\n      slow_time: \"SLOW TIME\",\n      shield: \"SHIELD\",\n      score_boost: \"SCORE x2\",\n    };\n    const POWER_COLORS: Record<string, string> = {\n      slow_time: \"#0ff\",\n      shield: \"#4af\",\n      score_boost: \"#ff0\",\n    };\n    const name = POWER_NAMES[game.power] ?? game.power.toUpperCase();\n    const color = POWER_COLORS[game.power] ?? \"#fff\";\n\n    ctx.font = `bold ${this.ps(0.013)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = color;\n    ctx.textAlign = \"right\";\n    ctx.textBaseline = \"top\";\n    ctx.fillText(name, barX + barW, barY);\n\n    const labelH = this.ps(0.016);\n    const countBarY = barY + labelH + 2;\n    ctx.fillStyle = \"#222\";\n    ctx.fillRect(barX, countBarY, barW, barH);\n\n    const frac = game.powerTimeLeft / 5.0;\n    ctx.fillStyle = color;\n    ctx.fillRect(barX, countBarY, barW * Math.max(0, frac), barH);\n\n    ctx.strokeStyle = \"#444\";\n    ctx.lineWidth = 1;\n    ctx.strokeRect(barX, countBarY, barW, barH);\n  }\n\n  // =========================================================================\n  // HUD: Phase overlays\n  // =========================================================================\n\n  private drawMenuHUD(): void {\n    const cx = this.w / 2;\n    const cy = this.h / 2;\n\n    this.glowText(\"OPAD\", cx, cy - this.ps(0.08), \"#0ff\", this.ps(0.08), true, 30);\n\n    this.hud.font = `${this.ps(0.02)}px 'Orbitron', sans-serif`;\n    this.hud.fillStyle = \"#888\";\n    this.hud.textAlign = \"center\";\n    this.hud.textBaseline = \"middle\";\n    this.hud.fillText(\"TUNNEL FLIGHT\", cx, cy);\n\n    this.hud.font = `${this.ps(0.016)}px 'Orbitron', sans-serif`;\n    this.hud.fillStyle = \"#555\";\n    this.hud.fillText(\"TAP TO START\", cx, cy + this.ps(0.08));\n  }\n\n  private drawCountdownHUD(game: Game): void {\n    const count = Math.max(1, Math.ceil(game.countdownValue));\n    const frac = game.countdownValue % 1;\n    const scale = 1 + frac * 0.3;\n    const size = this.ps(0.12) * scale;\n\n    this.hud.globalAlpha = 0.5 + frac * 0.5;\n    this.glowText(count.toString(), this.w / 2, this.h / 2, \"#0ff\", size, true, 25);\n    this.hud.globalAlpha = 1;\n\n    this.hud.font = `${this.ps(0.02)}px 'Orbitron', sans-serif`;\n    this.hud.fillStyle = \"#666\";\n    this.hud.textAlign = \"center\";\n    this.hud.textBaseline = \"middle\";\n    this.hud.fillText(\"ENTERING TUNNEL\", this.w / 2, this.h / 2 + this.ps(0.1));\n  }\n\n  private drawResultsHUD(game: Game): void {\n    const cx = this.w / 2;\n    const cy = this.h / 2;\n    const lineH = this.ps(0.05);\n    const ctx = this.hud;\n\n    this.glowText(\"MISSION COMPLETE\", cx, cy - lineH * 3, \"#0ff\", this.ps(0.06), true, 25);\n\n    ctx.font = `bold ${this.ps(0.045)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#fff\";\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillText(`${game.score}`, cx, cy - lineH * 1.5);\n\n    ctx.font = `${this.ps(0.022)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#ff0\";\n    ctx.fillText(`PERFECT  ${game.hits.perfect}`, cx, cy);\n    ctx.fillStyle = \"#0f0\";\n    ctx.fillText(`GOOD  ${game.hits.good}`, cx, cy + lineH * 0.8);\n    ctx.fillStyle = \"#f44\";\n    ctx.fillText(`MISS  ${game.hits.miss}`, cx, cy + lineH * 1.6);\n    ctx.fillStyle = \"#0ff\";\n    ctx.fillText(`MAX COMBO  ${game.maxCombo}`, cx, cy + lineH * 2.6);\n\n    const total = game.hits.perfect + game.hits.good + game.hits.miss;\n    const accuracy = total > 0\n      ? Math.round(((game.hits.perfect + game.hits.good * 0.5) / total) * 100)\n      : 0;\n    ctx.fillStyle = \"#fff\";\n    ctx.fillText(`ACCURACY  ${accuracy}%`, cx, cy + lineH * 3.4);\n\n    ctx.font = `${this.ps(0.016)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#555\";\n    ctx.fillText(\"TAP TO RETRY\", cx, cy + lineH * 4.8);\n  }\n\n  private drawGameOverHUD(game: Game): void {\n    const cx = this.w / 2;\n    const cy = this.h / 2;\n    const lineH = this.ps(0.05);\n    const ctx = this.hud;\n\n    this.glowText(\"SYSTEMS OFFLINE\", cx, cy - lineH * 2.5, \"#f44\", this.ps(0.07), true, 20);\n\n    ctx.font = `bold ${this.ps(0.035)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#fff\";\n    ctx.textAlign = \"center\";\n    ctx.textBaseline = \"middle\";\n    ctx.fillText(`SCORE  ${game.score}`, cx, cy - lineH * 0.8);\n\n    ctx.font = `${this.ps(0.022)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#ff0\";\n    ctx.fillText(`PERFECT  ${game.hits.perfect}`, cx, cy + lineH * 0.2);\n    ctx.fillStyle = \"#0f0\";\n    ctx.fillText(`GOOD  ${game.hits.good}`, cx, cy + lineH * 1.0);\n    ctx.fillStyle = \"#f44\";\n    ctx.fillText(`MISS  ${game.hits.miss}`, cx, cy + lineH * 1.8);\n    ctx.fillStyle = \"#0ff\";\n    ctx.fillText(`MAX COMBO  ${game.maxCombo}`, cx, cy + lineH * 2.8);\n\n    const progress = Math.round((game.time / game.beatmap.duration) * 100);\n    ctx.fillStyle = \"#888\";\n    ctx.fillText(`TUNNEL REACHED  ${progress}%`, cx, cy + lineH * 3.6);\n\n    ctx.font = `${this.ps(0.016)}px 'Orbitron', sans-serif`;\n    ctx.fillStyle = \"#555\";\n    ctx.fillText(\"TAP TO RETRY\", cx, cy + lineH * 5.0);\n  }\n\n  // =========================================================================\n  // Camera debug overlay\n  // =========================================================================\n\n  /** Initialize references to the camera debug DOM elements. */\n  initCamDebug(\n    debugEl: HTMLElement,\n    overlayCanvas: HTMLCanvasElement,\n    previewVideo: HTMLVideoElement,\n  ): void {\n    this._camDebugEl = debugEl;\n    this._camPreviewVideo = previewVideo;\n    const ctx = overlayCanvas.getContext(\"2d\");\n    if (ctx) this._camOverlay = ctx;\n  }\n\n  /** Toggle camera debug visibility and sync video stream. */\n  toggleCamDebug(sourceVideo: HTMLVideoElement): void {\n    this.camDebugVisible = !this.camDebugVisible;\n    if (!this._camDebugEl) return;\n\n    this._camDebugEl.style.display = this.camDebugVisible ? \"block\" : \"none\";\n\n    if (this.camDebugVisible && this._camPreviewVideo && sourceVideo.srcObject) {\n      this._camPreviewVideo.srcObject = sourceVideo.srcObject;\n    }\n  }\n\n  /** Draw hand landmarks on the camera debug overlay canvas. */\n  drawCamDebugOverlay(\n    landmarks: HandLandmark[] | null,\n    cursorIdx: number,\n    clampMin: number,\n    clampMax: number,\n  ): void {\n    if (!this._camOverlay || !this._camDebugEl) return;\n    if (!this.camDebugVisible) return;\n\n    const canvas = this._camOverlay.canvas;\n    const rect = this._camDebugEl.getBoundingClientRect();\n    if (canvas.width !== rect.width || canvas.height !== rect.height) {\n      canvas.width = rect.width;\n      canvas.height = rect.height;\n    }\n\n    const ctx = this._camOverlay;\n    const cw = canvas.width;\n    const ch = canvas.height;\n    ctx.clearRect(0, 0, cw, ch);\n\n    ctx.save();\n    ctx.translate(cw, 0);\n    ctx.scale(-1, 1);\n\n    const clampX = clampMin * cw;\n    const clampY = clampMin * ch;\n    const clampW = (clampMax - clampMin) * cw;\n    const clampH = (clampMax - clampMin) * ch;\n\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.35)\";\n    ctx.fillRect(0, 0, cw, clampY);\n    ctx.fillRect(0, clampY + clampH, cw, ch - clampY - clampH);\n    ctx.fillRect(0, clampY, clampX, clampH);\n    ctx.fillRect(clampX + clampW, clampY, cw - clampX - clampW, clampH);\n\n    ctx.strokeStyle = \"rgba(255, 255, 0, 0.6)\";\n    ctx.lineWidth = 1.5;\n    ctx.setLineDash([4, 3]);\n    ctx.strokeRect(clampX, clampY, clampW, clampH);\n    ctx.setLineDash([]);\n\n    ctx.fillStyle = \"rgba(255, 255, 0, 0.7)\";\n    ctx.font = \"8px 'Orbitron', sans-serif\";\n    ctx.textAlign = \"left\";\n    ctx.textBaseline = \"top\";\n    ctx.fillText(\"CLAMP\", clampX + 3, clampY + 2);\n\n    ctx.restore();\n\n    if (!landmarks || landmarks.length < 21) return;\n\n    ctx.save();\n    ctx.translate(cw, 0);\n    ctx.scale(-1, 1);\n\n    ctx.strokeStyle = \"rgba(0, 255, 255, 0.5)\";\n    ctx.lineWidth = 1.5;\n    for (const [a, b] of HAND_CONNECTIONS) {\n      const la = landmarks[a];\n      const lb = landmarks[b];\n      ctx.beginPath();\n      ctx.moveTo(la.x * cw, la.y * ch);\n      ctx.lineTo(lb.x * cw, lb.y * ch);\n      ctx.stroke();\n    }\n\n    for (let i = 0; i < landmarks.length; i++) {\n      const lm = landmarks[i];\n      const px = lm.x * cw;\n      const py = lm.y * ch;\n\n      if (i === cursorIdx) continue;\n\n      ctx.fillStyle = \"rgba(255, 255, 255, 0.7)\";\n      ctx.beginPath();\n      ctx.arc(px, py, 3, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    const active = landmarks[cursorIdx];\n    if (active) {\n      const ax = active.x * cw;\n      const ay = active.y * ch;\n\n      ctx.strokeStyle = \"#0ff\";\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.arc(ax, ay, 10, 0, Math.PI * 2);\n      ctx.stroke();\n\n      ctx.fillStyle = \"#0ff\";\n      ctx.beginPath();\n      ctx.arc(ax, ay, 4, 0, Math.PI * 2);\n      ctx.fill();\n\n      ctx.fillStyle = \"#0ff\";\n      ctx.font = \"10px 'Orbitron', sans-serif\";\n      ctx.textAlign = \"left\";\n      ctx.textBaseline = \"bottom\";\n      ctx.fillText(\"CURSOR\", ax + 14, ay - 2);\n    }\n\n    ctx.restore();\n  }\n}\n", "// --- Error capture (sends browser errors to dev server for logging) ---\nfunction reportError(entry: Record<string, unknown>): void {\n  const payload = JSON.stringify({\n    ...entry,\n    timestamp: new Date().toISOString(),\n    userAgent: navigator.userAgent,\n    url: location.href,\n  });\n  fetch(\"/api/errors\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: payload,\n  }).catch(() => { /* server may be down, ignore */ });\n}\n\nwindow.addEventListener(\"error\", (e: ErrorEvent) => {\n  reportError({\n    type: \"onerror\",\n    message: e.message,\n    source: e.filename,\n    lineno: e.lineno,\n    colno: e.colno,\n    stack: e.error?.stack,\n  });\n});\n\nwindow.addEventListener(\"unhandledrejection\", (e) => {\n  const reason = e.reason;\n  reportError({\n    type: \"unhandledrejection\",\n    message: reason?.message ?? String(reason),\n    stack: reason?.stack,\n  });\n});\n\nconst _origConsoleError = console.error;\nconsole.error = (...args: unknown[]) => {\n  _origConsoleError.apply(console, args);\n  // Suppress known non-critical errors from flooding the error log\n  const msg = args.map((a) => (typeof a === \"object\" ? JSON.stringify(a) : String(a))).join(\" \");\n  if (msg.includes(\"Failed to acquire camera feed\")) return;\n  reportError({ type: \"console.error\", message: msg });\n};\n\n// --- Game imports ---\nimport { Game } from \"../game/game.ts\";\nimport { convertLegacyBeatmap, generateBeatmap } from \"../game/beatmap.ts\";\nimport type { Beatmap } from \"../game/types.ts\";\nimport { AudioManager } from \"./audio.ts\";\nimport { InputManager } from \"./input.ts\";\nimport { Renderer } from \"./renderer.ts\";\n\nconst BEATMAP_URL = \"media/ep4.beatmap.json\";\nconst MUSIC_URL = \"media/ep4.mp3\";\n\nconst canvas = document.getElementById(\"game\") as HTMLCanvasElement;\nconst hudCanvas = document.getElementById(\"hud\") as HTMLCanvasElement;\nconst video = document.getElementById(\"cam\") as HTMLVideoElement;\nconst camDebugEl = document.getElementById(\"cam-debug\") as HTMLElement;\nconst camOverlay = document.getElementById(\"cam-overlay\") as HTMLCanvasElement;\nconst camPreview = document.getElementById(\"cam-preview\") as HTMLVideoElement;\n\nconst audio = new AudioManager();\nconst input = new InputManager(canvas, video);\nconst renderer = new Renderer(canvas, hudCanvas);\n\nrenderer.initCamDebug(camDebugEl, camOverlay, camPreview);\n\nlet loadedBeatmap: Beatmap | null = null;\nlet game = new Game(generateBeatmap());\nlet musicMode = false;\nlet musicStarted = false;\n\nlet lastTime = 0;\n\nfunction loop(now: number): void {\n  const dt = lastTime ? Math.min((now - lastTime) / 1000, 0.1) : 1 / 60;\n  lastTime = now;\n\n  input.update(dt);\n\n  if (game.phase === \"playing\" || game.phase === \"countdown\") {\n    if (musicMode && game.phase === \"playing\" && !musicStarted) {\n      // Countdown just finished \u2014 start the music now so music time\n      // and game time both begin from 0 together.\n      audio.startMusic();\n      musicStarted = true;\n    }\n    game.update(now / 1000, dt, input.gesture, audio);\n  }\n\n  // Stop music when game ends\n  if (musicMode && (game.phase === \"results\" || game.phase === \"gameover\")) {\n    audio.stopMusic();\n    musicStarted = false;\n  }\n\n  renderer.render(game, input.cursor, audio.musicMuted,\n    input.landmarks, input.cursorLandmarkIndex, input.clampMin, input.clampMax,\n    input.gesture);\n  requestAnimationFrame(loop);\n}\n\nasync function loadBeatmapAndMusic(): Promise<void> {\n  try {\n    const resp = await fetch(BEATMAP_URL);\n    if (resp.ok) {\n      // Convert legacy \"target\" events to \"slash\" events with direction\n      loadedBeatmap = convertLegacyBeatmap(await resp.json());\n      await audio.loadMusic(MUSIC_URL);\n      console.log(`Loaded beatmap: ${loadedBeatmap.events.length} events, ${loadedBeatmap.duration.toFixed(0)}s`);\n    }\n  } catch (e) {\n    console.log(\"No beatmap/music found, using procedural generation\", e);\n    loadedBeatmap = null;\n  }\n}\n\nasync function handleStart(): Promise<void> {\n  await audio.init();\n\n  if (loadedBeatmap) {\n    game = new Game(loadedBeatmap);\n    musicMode = true;\n    musicStarted = false;\n  } else {\n    game = new Game(generateBeatmap());\n    musicMode = false;\n    musicStarted = false;\n  }\n  game.start(performance.now() / 1000);\n}\n\nfunction hitTestMuteButton(clientX: number, clientY: number): boolean {\n  const r = renderer.muteButtonRect;\n  // Expand hit area for easier tapping\n  const margin = 10;\n  return (\n    clientX >= r.x - margin && clientX <= r.x + r.w + margin &&\n    clientY >= r.y - margin && clientY <= r.y + r.h + margin\n  );\n}\n\nfunction hitTestCamDebugButton(clientX: number, clientY: number): boolean {\n  const r = renderer.camDebugButtonRect;\n  const margin = 10;\n  return (\n    clientX >= r.x - margin && clientX <= r.x + r.w + margin &&\n    clientY >= r.y - margin && clientY <= r.y + r.h + margin\n  );\n}\n\nfunction handleClick(e: MouseEvent | Touch): void {\n  // Check mute button first (only during playing)\n  if (game.phase === \"playing\" && hitTestMuteButton(e.clientX, e.clientY)) {\n    audio.toggleMusicMute();\n    return;\n  }\n\n  // Check camera debug button (only during playing)\n  if (game.phase === \"playing\" && hitTestCamDebugButton(e.clientX, e.clientY)) {\n    renderer.toggleCamDebug(video);\n    return;\n  }\n\n  if (game.phase === \"menu\" || game.phase === \"results\" || game.phase === \"gameover\") {\n    handleStart();\n  }\n}\n\ncanvas.addEventListener(\"click\", (e) => handleClick(e));\ncanvas.addEventListener(\"touchend\", (e) => {\n  e.preventDefault();\n  if (e.changedTouches.length > 0) {\n    handleClick(e.changedTouches[0]);\n  }\n}, { passive: false });\n\n// Draw initial menu state\nrenderer.render(game, input.cursor);\n\n// Pre-load beatmap and music (falls back to procedural if unavailable)\nloadBeatmapAndMusic();\n\n// Init input (attempts hand tracking, falls back to mouse/touch)\ninput.init().then((mode) => {\n  console.log(`Input mode: ${mode}`);\n});\n\n// --- Test harness (exposes internals for Playwright visual tests) ---\n// deno-lint-ignore no-explicit-any\n(window as any).__OPAD_TEST__ = {\n  getGame: () => game,\n  getRenderer: () => renderer,\n  getAudio: () => audio,\n  /** Replace game with a new instance using a custom beatmap and render one frame. */\n  setGame: (beatmap: Beatmap) => {\n    game = new Game(beatmap);\n    renderer.render(game, input.cursor);\n  },\n  /** Start the current game (transitions from menu to countdown). */\n  startGame: () => {\n    game.start(performance.now() / 1000);\n  },\n  /** Tick the game forward by dt seconds and render. */\n  tickAndRender: (dt: number, cursorX = 0.5, cursorY = 0.5) => {\n    const nullAudio = { playTick() {}, playHit() {}, playMiss() {}, playDamage() {}, playCombo() {}, playSlash() {} };\n    const cursor = { x: cursorX, y: cursorY };\n    const nullGesture = { lanesPressed: [false, false, false, false] };\n    game.tick(dt, nullGesture, nullAudio);\n    renderer.render(game, cursor);\n  },\n  /** Render current state without advancing time. */\n  renderFrame: (cursorX = 0.5, cursorY = 0.5) => {\n    renderer.render(game, { x: cursorX, y: cursorY });\n  },\n};\n\n// Start render loop\nrequestAnimationFrame(loop);\n"],
  "mappings": "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",
  "names": []
}
